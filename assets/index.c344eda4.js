var pt=Object.defineProperty,mt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var Z=(r,t,n)=>t in r?pt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,U=(r,t)=>{for(var n in t||(t={}))ft.call(t,n)&&Z(r,n,t[n]);if(st)for(var n of st(t))_t.call(t,n)&&Z(r,n,t[n]);return r},N=(r,t)=>mt(r,gt(t));var S=(r,t,n)=>(Z(r,typeof t!="symbol"?t+"":t,n),n);import{M as O,Q as bt,o as l,c,a as e,w as p,v as F,t as h,b,d as f,n as D,e as $,f as k,F as T,r as L,g as G,h as u,P as yt,i as w,j as x,p as wt,k as vt,u as X,l as kt,m as nt,q as V,s as j,T as xt,x as ot,y as it,z as Ct,A as St,B as Dt}from"./vendor.d01b3ca9.js";const Tt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};Tt();let J="fetch"in globalThis?fetch:require("isomorphic-fetch");class H{constructor(t){S(this,"syncId","");S(this,"password","");S(this,"server","");S(this,"hasCredentials",!1);S(this,"lastUpdated",null);S(this,"storage");S(this,"serverList",[{url:"https://api.xbrowsersync.org",location:"United Kingdom",storage:"1MB"},{url:"https://xbrowsersync.freerangecloud.com",location:"Canada",storage:"9.77MB"},{url:"https://sync.adminforge.de",location:"Germany",storage:"4.88MB"},{url:"https://xbrowsersync.servicesforfree.com",location:"Germany",storage:"20MB"},{url:"https://xbs.eris.cc",location:"Germany",storage:"5MB"},{url:"https://xbsapi.cgrx.de",location:"Germany",storage:"9.77MB"},{url:"https://xsync.nixnet.services",location:"Germany",storage:"10MB"},{url:"https://xbs.25mb.co.uk",location:"United Kingdom",storage:"1MB"},{url:"https://xbs.andrewkdinh.com",location:"United States",storage:"1MB"}]);this.storage=t;const n=this.storage.get("credentials");n&&(this.syncId=n.syncId,this.password=n.password,this.server=n.server,this.hasCredentials=!0);const a=this.storage.get("lastUpdated");a&&(this.lastUpdated=new Date(a))}getCryptoImpl(){return window.crypto.subtle}getRandomValues(t){return window.crypto.getRandomValues(t)}generateNewSyncId(t){return t=t.replace(/\/+$/,""),J(t+"/bookmarks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version:"1.1.13"})}).then(n=>n.json())}setCredentials(t,n,a,s){this.server=t.replace(/\/+$/,""),this.syncId=n,this.password=a,this.hasCredentials=!0,s&&this.storeCredentials()}forgetCredentials(){this.password="",this.server="",this.syncId="",this.storage.remove("credentials"),this.hasCredentials=!1}getCredentials(){return{password:this.password,server:this.server,syncId:this.syncId}}async getLastUpdated(t=!0){return J(`${this.server}/bookmarks/${this.syncId}/lastUpdated`,{headers:{"Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{if(n.message)return{error:!0,message:n.message};const a=new Date(n.lastUpdated);return t&&this.setLastUpdated(a),a})}setLastUpdated(t){this.lastUpdated=t,this.storage.set("lastUpdated",this.lastUpdated.toISOString())}storeCredentials(){this.storage.set("credentials",{syncId:this.syncId,password:this.password,server:this.server})}async needsUpdate(){return this.getLastUpdated(!1).then(t=>{if("error"in t)throw new Error(t.message);return+this.lastUpdated!=+t})}async load(){const t=await J(`${this.server}/bookmarks/${this.syncId}`,{headers:{"Content-Type":"application/json"}}).then(s=>s.json());if(!("bookmarks"in t))return!1;"lastUpdated"in t&&this.setLastUpdated(new Date(t.lastUpdated));const n=await this.decryptData(t.bookmarks,this.password,!1);let a=await this.decompress(n);return JSON.parse(a)}async store(t){const n=JSON.stringify(t);if(this.hasCredentials){const a=await this.compress(n),s=await this.encryptData(a,this.password);return J(this.server+"/bookmarks/"+this.syncId,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookmarks:s})}).then(o=>o.json()).then(o=>{if("message"in o){console.log("whaty fucky");return}return this.setLastUpdated(new Date(o.lastUpdated)),{original:n.length,compressed:a.byteLength,encrypted:s.length}})}return null}async compress(t,n="deflate"){const a=new TextEncoder().encode(t),s=new CompressionStream(n),o=s.writable.getWriter();return o.write(a),o.close(),new Response(s.readable).arrayBuffer()}async decompress(t,n="deflate"){const a=new DecompressionStream("deflate"),s=a.writable.getWriter();return s.write(t),s.close(),new Response(a.readable).arrayBuffer().then(function(o){return new TextDecoder().decode(o)})}buff_to_base64(t){return btoa(String.fromCharCode.apply(null,t))}base64_to_buf(t){return Uint8Array.from(atob(t),n=>n.charCodeAt(null))}getPasswordKey(t){return this.getCryptoImpl().importKey("raw",new TextEncoder().encode(t),"PBKDF2",!1,["deriveKey"])}deriveKey(t,n,a){return this.getCryptoImpl().deriveKey({name:"PBKDF2",salt:n,iterations:25e4,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,a)}async encryptData(t,n){try{const a=this.getRandomValues(new Uint8Array(16)),s=this.getRandomValues(new Uint8Array(12)),o=await this.getPasswordKey(n),i=await this.deriveKey(o,a,["encrypt"]),d=await this.getCryptoImpl().encrypt({name:"AES-GCM",iv:s},i,typeof t=="string"?new TextEncoder().encode(t):t),m=new Uint8Array(d),_=new Uint8Array(a.byteLength+s.byteLength+m.byteLength);return _.set(a,0),_.set(s,a.byteLength),_.set(m,a.byteLength+s.byteLength),this.buff_to_base64(_)}catch(a){return console.log(`Error - ${a}`),""}}async decryptData(t,n,a=!0){try{const s=this.base64_to_buf(t),o=s.slice(0,16),i=s.slice(16,16+12),d=s.slice(16+12),m=await this.getPasswordKey(n),_=await this.deriveKey(m,o,["decrypt"]),g=await this.getCryptoImpl().decrypt({name:"AES-GCM",iv:i},_,d);return a?new TextDecoder().decode(g):g}catch(s){return console.log(`Error - ${s}`),""}}async createConnectionStrings(t,n=!1){let a={cli:`tmlg --sync-setup --sync-enable --sync-server "${this.server}" --sync-id "${this.syncId}" --sync`};return n&&(a.cli+=` --sync-password "${this.password}"`),t&&typeof t=="string"&&(a.url=await this.encryptData(JSON.stringify({syncId:this.syncId,server:this.server}),this.password).then(s=>{const o=new URL(t);return o.searchParams.set("encryptedSyncCredentials",s),n&&o.searchParams.set("password",btoa(this.password)),o.toString()})),a}}var v=(r,t)=>{const n=r.__vccOpts||r;for(const[a,s]of t)n[a]=s;return n};const $t={inject:["util","globalStore","settings"],name:"SyncOptionsDialog",props:{sync:H},data(){return{modal:!1,loginError:!1,includePasswordInQRCode:!1,syncId:null,server:"",passwordType:"password",registerError:null,password:"",passwordRepeat:"",passwordValid:!1,passwordRepeatValid:!1,syncURL:null,syncCLICommand:null,view:"status",hasCompressionStream:"CompressionStream"in window,hasDecompressionStream:"DecompressionStream"in window,hasCrypto:"crypto"in window,hasCryptoSubtle:"crypto"in window&&"subtle"in window.crypto}},watch:{password(r){this.passwordValid=r.length>7,this.passwordRepeatValid=this.password===this.passwordRepeat},passwordRepeat(){this.passwordRepeatValid=this.password===this.passwordRepeat},includePasswordInQRCode(){this.createQRCode()}},mounted(){this.modal=new O(this.$refs.modal),this.$refs.modal.addEventListener("show.bs.modal",r=>{this.server=this.sync.server||this.sync.serverList[0].url}),this.$refs.modal.addEventListener("hidden.bs.modal",r=>{this.server=null,this.view="status",this.passwordType="password",this.registerError=null,this.password="",this.passwordRepeat="",this.passwordValid=!1,this.passwordRepeatValid=!1})},methods:{show(){this.modal.show()},attemptLogin(){this.globalStore.setLoading(!0),this.sync.setCredentials(this.server,this.syncId,this.password),this.sync.getLastUpdated().then(r=>{if(this.globalStore.setLoading(!1),"error"in r){this.loginError=`Error: ${r.message}`;return}this.sync.storeCredentials(),this.globalStore.toast("sync","login successful")})},showSyncURL(){this.view="showSyncURL",this.createQRCode()},createQRCode(){this.sync.createConnectionStrings(window.location.toString(),this.includePasswordInQRCode).then(r=>{this.syncCLICommand=r.cli,this.syncURL=r.url,console.log({r}),this.$refs.qrcode.querySelector("canvas")&&this.$refs.qrcode.querySelector("canvas").remove(),new bt(this.$refs.qrcode,{text:this.syncURL,quietZone:40,width:600,height:600,onRenderingEnd:()=>{this.$refs.qrcode.querySelector("canvas").classList.add("img-fluid","d-block"),this.$refs.qrcode.querySelector("canvas").style.setProperty("image-rendering","pixelated")}})})},registerSyncId(){this.globalStore.setLoading(!0),this.view="register",this.sync.generateNewSyncId(this.server).then(r=>{this.globalStore.setLoading(!1),"code"in r&&/exception/i.test(r.code)?(this.view="registerError",this.registerError=r.message):this.syncId=r.id})},setSyncCredentials(){this.sync.setCredentials(this.server,this.syncId,this.password),this.sync.getLastUpdated().then(r=>{if("error"in r){this.registerError=r.message,this.view="registerError";return}this.sync.storeCredentials(),this.modal.hide(),this.globalStore.toast("sync","Synchronization is connected!")})},forgetSyncCredentials(){if(!confirm("are you sure?"))return!1;this.settings.syncEnabled=!1,this.sync.forgetCredentials(),this.modal.hide(),this.globalStore.toast("sync","your credentials have been removed...")}}},It={class:"modal fade",ref:"modal",id:"syncSetup","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"syncSetupLabel","aria-hidden":"true"},Lt={class:"modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"},Ft={class:"modal-content"},Rt={class:"modal-header"},Mt={class:"modal-title fw-light",id:"syncSetupLabel"},Et=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ut={class:"modal-body"},jt={class:"row"},Pt={class:"col-12"},Vt={key:0,class:"table table-sm"},Ot=e("th",{scope:"row"},"server",-1),Bt=e("th",{scope:"row"},"syncId",-1),At=e("th",{scope:"row"},"password",-1),Ht={class:"d-flex justify-content-between"},zt={key:0},Nt={key:1},qt=e("th",{scope:"row"},"last updated",-1),Yt={key:1},Kt={class:"list-group list-group-flush"},Qt={key:2},Jt=e("p",null," Sync is not available because wour browser doesn't support one or more of those features: ",-1),Gt={class:"table"},Wt=e("td",null,[e("code",null,"CompressionStream")],-1),Zt=e("td",null,[e("code",null,"DecompressionStream")],-1),Xt=e("td",null,[e("code",null,"Crypto")],-1),te=e("td",null,[e("code",null,"CryptoSubtle")],-1),ee={class:"row"},se={class:"col-12"},ne={ref:"qrcode",id:"qrcode-wrap",class:"mw-100 mx-auto"},oe=e("label",{class:"form-check-label",for:"include_password"}," Include Password in URL ",-1),ie={class:"input-group mb-3"},re=e("p",null," Open the URL on the device that you want to sync your timelogs on and enter your password when prompted. ",-1),ae=e("hr",null,null,-1),le=e("p",null," Use the command below to se tup a cli installation ",-1),de={class:"input-group mb-3"},ce=e("p",null,[u(" Use "),e("code",null,"npm i tmlg -g"),u(" to install the app on your machine ")],-1),ue={class:"row"},he={class:"col-12"},pe={class:"mb-1"},me=e("label",{for:"server",class:"form-label"},"Server",-1),ge={id:"serverList"},fe=["value"],_e={class:"mb-1"},be=e("label",{for:"login_syncId",class:"form-label"},"SyncId",-1),ye={class:"mb-1"},we=e("label",{for:"login_password",class:"form-label"},"Password",-1),ve={class:"input-group"},ke=["type"],xe={key:0,class:"alert alert-warning"},Ce={class:"d-flex justify-content-center mt-3"},Se=["disabled"],De={class:"row"},Te={class:"col-12"},$e=e("p",null,"There was an error fetching a new sync id from the service:",-1),Ie={class:"row"},Le={class:"col-12"},Fe={class:"mb-1"},Re=e("label",{for:"serverURL",class:"form-label"},"API Server URL",-1),Me=e("p",{class:"my-1"}," Public servers ",-1),Ee={class:"list-group list-group-flush mb-3"},Ue=["onClick"],je=e("br",null,null,-1),Pe={class:"d-flex justify-content-center"},Ve=["disabled"],Oe={class:"row"},Be={class:"col-12"},Ae={class:"mb-1"},He=e("label",{for:"serverURL",class:"form-label"},"Server",-1),ze={class:"mb-1"},Ne=e("label",{for:"syncId",class:"form-label"},"SyncId",-1),qe={class:"mb-1"},Ye=e("label",{for:"register_password",class:"form-label"},"Password",-1),Ke={class:"input-group"},Qe=["type"],Je={class:"mb-1"},Ge=e("label",{for:"password_repeat",class:"form-label"},"Repeat Password",-1),We={class:"input-group"},Ze=["type"],Xe=e("div",{class:"small mb-1"},[e("p",{class:"mb-2"},[u("Make sure you save the password in your browser or password manager, there is "),e("u",null,"no way"),u(" to recover it!")]),e("p",null,"The password will be stored as plain text in your browser, so use an unique password!")],-1),ts={class:"d-flex justify-content-center"},es=["disabled"];function ss(r,t,n,a,s,o){return l(),c("div",It,[e("div",Lt,[e("div",Ft,[e("div",Rt,[e("h5",Mt,[p(e("span",null,"Sync Info ",512),[[F,s.view==="status"&&n.sync.hasCredentials]]),p(e("span",null,"Synchronization ",512),[[F,s.view==="status"&&!n.sync.hasCredentials]]),p(e("span",null,"Login",512),[[F,s.view==="login"]]),p(e("span",null,"Register",512),[[F,s.view==="register"]]),p(e("span",null,"Registration failed",512),[[F,s.view==="registerError"]]),p(e("span",null,"Sync URL",512),[[F,s.view==="showSyncURL"]])]),Et]),e("div",Ut,[p(e("div",jt,[e("div",Pt,[n.sync.hasCredentials?(l(),c("table",Vt,[e("tbody",null,[e("tr",null,[Ot,e("td",null,[e("code",null,h(n.sync.server),1)])]),e("tr",null,[Bt,e("td",null,[e("code",null,h(n.sync.syncId),1)])]),e("tr",null,[At,e("td",null,[e("div",Ht,[s.passwordType==="password"?(l(),c("code",zt,h(n.sync.password.replace(/./g,"*")),1)):(l(),c("code",Nt,h(n.sync.password),1)),s.passwordType==="password"?(l(),c("a",{key:2,href:"#",onClick:t[0]||(t[0]=b(i=>s.passwordType="text",["stop","prevent"]))},"show")):f("",!0),s.passwordType==="text"?(l(),c("a",{key:3,href:"#",onClick:t[1]||(t[1]=b(i=>s.passwordType="password",["stop","prevent"]))},"hide")):f("",!0)])])]),e("tr",null,[qt,e("td",null,[e("code",null,h(n.sync.lastUpdated?n.sync.lastUpdated.toLocaleString():"n/a"),1)])])])])):f("",!0),s.hasCompressionStream&&s.hasDecompressionStream&&s.hasCrypto&&s.hasCryptoSubtle?(l(),c("div",Yt,[e("div",Kt,[n.sync.hasCredentials?f("",!0):(l(),c("button",{key:0,onClick:t[2]||(t[2]=i=>s.view="login"),type:"button",class:"list-group-item text-center list-group-item-action"}," connect with sync id and password ")),n.sync.hasCredentials?f("",!0):(l(),c("button",{key:1,onClick:t[3]||(t[3]=i=>s.view="serverSelect"),type:"button",class:"list-group-item text-center list-group-item-action"}," register new sync id and password ")),n.sync.hasCredentials?(l(),c("button",{key:2,onClick:t[4]||(t[4]=(...i)=>o.forgetSyncCredentials&&o.forgetSyncCredentials(...i)),type:"button",class:"list-group-item text-center list-group-item-action"}," remove currently stored credentials ")):f("",!0),n.sync.hasCredentials?(l(),c("button",{key:3,onClick:t[5]||(t[5]=(...i)=>o.showSyncURL&&o.showSyncURL(...i)),type:"button",class:"list-group-item text-center list-group-item-action"}," Connect other devices and platforms ")):f("",!0)])])):(l(),c("div",Qt,[Jt,e("table",Gt,[e("tr",null,[Wt,e("td",null,h(s.hasCompressionStream?"ok":"no"),1)]),e("tr",null,[Zt,e("td",null,h(s.hasDecompressionStream?"ok":"no"),1)]),e("tr",null,[Xt,e("td",null,h(s.hasCrypto?"ok":"no"),1)]),e("tr",null,[te,e("td",null,h(s.hasCryptoSubtle?"ok":"no"),1)])])]))])],512),[[F,s.view==="status"]]),p(e("div",ee,[e("div",se,[e("div",ne,null,512),e("div",{class:D(["form-check form-switch my-2",{"text-warning":s.includePasswordInQRCode}])},[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"include_password","onUpdate:modelValue":t[6]||(t[6]=i=>s.includePasswordInQRCode=i)},null,512),[[$,s.includePasswordInQRCode]]),oe],2),e("div",ie,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=i=>s.syncURL=i),readonly:""},null,512),[[k,s.syncURL]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[8]||(t[8]=b(i=>{o.util.copyToClipboard(s.syncURL,r.$refs.qrcode),o.globalStore.toast("copied!")},["stop","prevent"]))},"copy ")]),re,ae,le,e("div",de,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=i=>s.syncCLICommand=i),readonly:""},null,512),[[k,s.syncCLICommand]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[10]||(t[10]=b(i=>{o.util.copyToClipboard(s.syncCLICommand,r.$refs.qrcode),o.globalStore.toast("copied!")},["stop","prevent"]))},"copy ")]),ce])],512),[[F,s.view==="showSyncURL"]]),p(e("div",ue,[e("div",he,[e("div",pe,[me,p(e("input",{class:"form-control",list:"serverList",id:"server",placeholder:"Type to search...","onUpdate:modelValue":t[11]||(t[11]=i=>s.server=i)},null,512),[[k,s.server]]),e("datalist",ge,[(l(!0),c(T,null,L(n.sync.serverList,i=>(l(),c("option",{value:i.url},null,8,fe))),256))])]),e("div",_e,[be,p(e("input",{class:"form-control",id:"login_syncId","onUpdate:modelValue":t[12]||(t[12]=i=>s.syncId=i)},null,512),[[k,s.syncId]])]),e("div",ye,[we,e("div",ve,[p(e("input",{class:"form-control",type:s.passwordType,autocomplete:"current-password",id:"login_password","onUpdate:modelValue":t[13]||(t[13]=i=>s.password=i)},null,8,ke),[[G,s.password]]),e("button",{class:"btn-outline-secondary btn",id:"passwordAddon",onClick:t[14]||(t[14]=i=>s.passwordType=s.passwordType==="password"?"text":"password")},h(s.passwordType==="password"?"show":"hide"),1)])]),s.loginError?(l(),c("div",xe,h(s.loginError),1)):f("",!0),e("div",Ce,[e("button",{class:"btn btn-outline-primary",onClick:t[15]||(t[15]=(...i)=>o.attemptLogin&&o.attemptLogin(...i)),disabled:!s.server||!s.syncId||!s.password},"Login ",8,Se)])])],512),[[F,s.view==="login"]]),p(e("div",De,[e("div",Te,[$e,e("p",null,[e("code",null,h(s.registerError),1)])])],512),[[F,s.view==="registerError"]]),p(e("div",Ie,[e("div",Le,[e("div",Fe,[Re,p(e("input",{class:"form-control",type:"url",id:"serverURL","onUpdate:modelValue":t[16]||(t[16]=i=>s.server=i)},null,512),[[k,s.server]]),Me,e("div",Ee,[(l(!0),c(T,null,L(n.sync.serverList,i=>(l(),c("button",{class:"list-group-item list-group-item-action",onClick:d=>s.server=i.url},[e("span",null,h(i.url),1),je,e("small",null,h(i.location+", "+i.storage),1)],8,Ue))),256))])]),e("div",Pe,[e("button",{class:"btn btn-outline-primary",onClick:t[17]||(t[17]=(...i)=>o.registerSyncId&&o.registerSyncId(...i)),disabled:!s.server},"Create Synchronization ",8,Ve)])])],512),[[F,s.view==="serverSelect"]]),p(e("div",Oe,[e("div",Be,[e("div",Ae,[He,p(e("input",{class:"form-control",disabled:"",id:"serverURL",readonly:"","onUpdate:modelValue":t[18]||(t[18]=i=>s.server=i)},null,512),[[k,s.server]])]),e("div",ze,[Ne,p(e("input",{class:"form-control",disabled:"",id:"syncId",readonly:"","onUpdate:modelValue":t[19]||(t[19]=i=>s.syncId=i)},null,512),[[k,s.syncId]])]),e("div",qe,[Ye,e("div",Ke,[p(e("input",{class:D([{"is-invalid":s.password&&!s.passwordValid,"is-valid":s.password&&s.passwordValid},"form-control"]),type:s.passwordType,autocomplete:"new-password",id:"register_password","onUpdate:modelValue":t[20]||(t[20]=i=>s.password=i)},null,10,Qe),[[G,s.password]]),e("button",{class:"btn-outline-secondary btn",id:"passwordAddon",onClick:t[21]||(t[21]=i=>s.passwordType=s.passwordType==="password"?"text":"password")},h(s.passwordType==="password"?"show":"hide"),1)])]),e("div",Je,[Ge,e("div",We,[p(e("input",{class:D(["form-control",{"is-invalid":s.passwordRepeat&&!s.passwordRepeatValid,"is-valid":s.passwordRepeat&&s.passwordRepeatValid}]),type:s.passwordType,autocomplete:"new-password",id:"passwordRepeat","onUpdate:modelValue":t[22]||(t[22]=i=>s.passwordRepeat=i)},null,10,Ze),[[G,s.passwordRepeat]]),e("button",{class:"btn-outline-secondary btn",id:"passwordRepeatAddon",onClick:t[23]||(t[23]=i=>s.passwordType=s.passwordType==="password"?"text":"password")},h(s.passwordType==="password"?"show":"hide"),1)])]),Xe,e("div",ts,[e("button",{class:"btn btn-outline-primary",onClick:t[24]||(t[24]=(...i)=>o.setSyncCredentials&&o.setSyncCredentials(...i)),disabled:!s.passwordValid||!s.passwordRepeatValid},"Create Synchronization ",8,es)])])],512),[[F,s.view==="register"]])])])])],512)}var ns=v($t,[["render",ss]]);const os={inject:["util","globalStore","settings"],props:{sync:H},data(){return{modal:null,currencyIsValid:!0,dateFormatIsValid:!0,dateRangeFormatIsValid:!0,currentTab:"input"}},mounted(){this.modal=new O(this.$refs.modal),Array.from(this.$refs.modal.querySelectorAll('[data-bs-toggle="popover"]')).forEach(r=>{new yt(r,{trigger:"focus"})})},watch:{settings:{deep:!0,handler:function(r,t){this.checkValidity(),this.settings.defaultClient=this.settings.defaultClient.replace(/[@%\/#:+]/g,""),this.settings.defaultProject=this.settings.defaultProject.replace(/[@%\/#:+]/g,""),this.settings.defaultTask=this.settings.defaultTask.replace(/[@%\/#:+]/g,""),this.settings.defaultSource=this.settings.defaultSource.replace(/[@%\/#:+]/g,""),this.settings.syncEnabled&&this.$emit("enable-sync")}}},methods:{checkValidity(){const r=this.settings.dateFormat,t=this.settings.dateRangeFormat;this.currencyIsValid=/%s/.test(this.settings.currencyFormat)&&!/^%s$/.test(this.settings.currencyFormat.trim())&&this.settings.currencyFormat!=="",this.dateFormatIsValid=r.match(/d/g).length===2&&r.match(/m/g).length===2&&r.match(/y/g).length===4,this.dateRangeFormatIsValid=t.match(/dd/g).length===2&&t.match(/mm/g).length===2&&t.match(/yyyy/g).length===2},show(){this.modal.show()},saveSettings(){this.globalStore.toast("settings saved"),this.settings.syncSettings&&this.$emit("store"),this.modal.hide()}}},is={class:"modal fade",ref:"modal",id:"settings","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"settingsLabel","aria-hidden":"true"},rs={class:"modal-dialog modal-dialog-scrollable modal-fullscreen-md-down modal-lg"},as={class:"modal-content"},ls=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"settingsLabel"},"Settings"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ds={class:"modal-body"},cs={class:"nav nav-tabs mb-4"},us={class:"nav-item"},hs={class:"nav-item"},ps=e("span",{class:"d-none d-lg-inline"},"Synchronization",-1),ms=e("span",{class:"d-lg-none"},"Sync",-1),gs=[ps,ms],fs={class:"nav-item"},_s=e("span",{class:"d-none d-lg-inline"},"Timelogs",-1),bs=e("span",{class:"d-lg-none"},"Logs",-1),ys=[_s,bs],ws={class:"nav-item"},vs={class:"nav-item"},ks={class:"form-check form-switch mb-4"},xs=e("label",{class:"form-check-label",for:"storeOnControlEnter"},[u(" store on "),e("kbd",null,"ctrl"),u("+"),e("kbd",null,"enter"),u(" ("),e("kbd",null,"cmd"),u("+"),e("kbd",null,"enter"),u(") ")],-1),Cs={class:"form-check form-switch mb-4"},Ss=e("label",{class:"form-check-label",for:"clearTimeLogOnStore"}," clear timelog on store ",-1),Ds={class:"form-check form-switch mb-4"},Ts=e("label",{class:"form-check-label",for:"showParsePreviewOnType"}," show parsed data while typing ",-1),$s={class:"form-check form-switch mb-4"},Is=e("label",{class:"form-check-label",for:"showHelpIcon"}," show help icon ",-1),Ls={key:0,class:"small"},Fs={class:"form-check form-switch mb-4"},Rs=["disabled"],Ms=e("label",{class:"form-check-label",for:"syncEnabled"}," sync enabled ",-1),Es={class:"form-check form-switch mb-4"},Us=["disabled"],js=e("label",{class:"form-check-label",for:"syncSettings"}," sync settings ",-1),Ps={class:"mb-4"},Vs=e("label",{for:"checkForUpdateIntervalMinutes",class:"form-label mb-0"},"sync interval minutes (0=off):",-1),Os={class:"row g-1"},Bs={class:"col-2"},As=["disabled"],Hs={class:"col-10 pt-1"},zs=["disabled"],Ns={class:"mb-4"},qs=e("label",{for:"defaultDuration",class:"form-label mb-0"},"Default duration minutes:",-1),Ys={class:"row g-1"},Ks={class:"col-2"},Qs={class:"col-10 pt-1"},Js={class:"mb-4"},Gs=e("label",{for:"hourThreshold",class:"form-label mb-0"},"Single digit hour threshold:",-1),Ws={class:"row g-1"},Zs={class:"col-2"},Xs={class:"col-10 pt-1"},tn={class:"mb-4"},en={for:"defaultRate",class:"form-label mb-0"},sn={class:"row g-1"},nn={class:"col-2"},on={class:"col-10 pt-1"},rn={class:"form-check form-switch mb-4"},an=e("label",{class:"form-check-label",for:"rateIncludesTax"}," rate includes tax ",-1),ln={class:"mb-4"},dn=e("label",{for:"tax",class:"form-label mb-0"},"Tax rate (%):",-1),cn={class:"row g-1"},un={class:"col-2"},hn={class:"col-10 pt-1"},pn={class:"input-group input-group-sm mb-4"},mn=e("div",{class:"input-group-text"},[e("label",{for:"dateFormat"},"Date Format"),e("a",{tabindex:"0",role:"button",class:"badge border rounded-circle small ms-2","data-bs-toggle":"popover","data-bs-content":"the date format must include yy, mm and dddd, in any order, separated by any character"},"?")],-1),gn={class:"input-group input-group-sm mb-4"},fn=e("div",{class:"input-group-text"},[e("label",{for:"currencyFormat"},"Currency Format"),e("a",{class:"badge border rounded-circle small ms-2",tabindex:"0",role:"button","data-bs-toggle":"popover","data-bs-content":"%s will be replaced with actual amount"},"?")],-1),_n={class:"input-group input-group-sm mb-4 position-relative"},bn=e("label",{for:"defaultProject",class:"input-group-text"},"Default %project",-1),yn={class:"input-group input-group-sm mb-4"},wn=e("label",{for:"defaultClient",class:"input-group-text"},"Default @client",-1),vn={class:"input-group input-group-sm mb-4"},kn=e("label",{for:"defaultTask",class:"input-group-text"},"Default #task",-1),xn={class:"input-group input-group-sm mb-4"},Cn=e("label",{for:"defaultSource",class:"input-group-text"},"Default /source",-1),Sn={class:"form-check form-switch mb-4"},Dn=e("label",{class:"form-check-label",for:"showCostColumn"},[u(" show "),e("code",null,"cost"),u(" column ")],-1),Tn={class:"form-check form-switch mb-4"},$n=e("label",{class:"form-check-label",for:"showProjectColumn"},[u(" show "),e("code",null,"project"),u(" column ")],-1),In={class:"form-check form-switch mb-4"},Ln=e("label",{class:"form-check-label",for:"showClientColumn"},[u(" show "),e("code",null,"client"),u(" column ")],-1),Fn={class:"form-check form-switch mb-4"},Rn=e("label",{class:"form-check-label",for:"showTaskColumn"},[u(" show "),e("code",null,"task"),u(" column ")],-1),Mn={class:"form-check form-switch mb-4"},En=e("label",{class:"form-check-label",for:"showSourceColumn"},[u(" show "),e("code",null,"source"),u(" column ")],-1),Un={class:"form-check form-switch mb-4"},jn=e("label",{class:"form-check-label",for:"showDupeButton"}," show duplicate button ",-1),Pn={class:"form-check form-switch mb-4"},Vn=e("label",{class:"form-check-label",for:"keepOriginalLogOnEdit"}," keep original log when date is changed while editing ",-1),On={class:"input-group input-group-sm mb-4"},Bn=e("div",{class:"input-group-text"},[e("label",{for:"dateRangeFormat"},[e("span",{class:"d-none d-lg-inline"},"Date Range Format"),e("span",{class:"d-lg-none"},"Dt Rng Frmt")]),e("a",{tabindex:"0",role:"button",class:"badge border rounded-circle small ms-2","data-bs-toggle":"popover","data-bs-content":"Same as date format. Start date placeholders with trailing '?' will be omitted when date component is same on end date"},"?")],-1),An={class:"form-check form-switch mb-4"},Hn=e("label",{class:"form-check-label",for:"closeFiltersOnApply"}," Close Filters on Apply/Clear ",-1),zn={class:"input-group input-group-sm mb-4"},Nn=e("div",{class:"input-group-text"},[e("label",{for:"filenameTemplate"},"DL Filename"),e("a",{tabindex:"0",role:"button",class:"badge border rounded-circle small ms-2","data-bs-toggle":"popover","data-bs-content":"%s will be replaced with date range"},"?")],-1),qn={class:"input-group input-group-sm mb-4"},Yn=e("label",{for:"deviceName",class:"input-group-text"},"Device name",-1),Kn={class:"input-group input-group-sm mb-4"},Qn=e("label",{for:"deviceId",class:"input-group-text"},"Device ID",-1),Jn={class:"d-flex justify-content-center"};function Gn(r,t,n,a,s,o){return l(),c("div",is,[e("div",rs,[e("div",as,[ls,e("div",ds,[e("ul",cs,[e("li",us,[e("a",{class:D(["nav-link px-2 px-lg-3",{active:s.currentTab==="input"}]),href:"#",onClick:t[0]||(t[0]=b(i=>s.currentTab="input",["stop","prevent"]))},"Input",2)]),e("li",hs,[e("a",{class:D(["nav-link px-2 px-lg-3",{active:s.currentTab==="sync"}]),href:"#",onClick:t[1]||(t[1]=b(i=>s.currentTab="sync",["stop","prevent"]))},gs,2)]),e("li",fs,[e("a",{class:D(["nav-link px-2 px-lg-3",{active:s.currentTab==="timelogs"}]),href:"#",onClick:t[2]||(t[2]=b(i=>s.currentTab="timelogs",["stop","prevent"]))},ys,2)]),e("li",ws,[e("a",{class:D(["nav-link px-2 px-lg-3",{active:s.currentTab==="table"}]),href:"#",onClick:t[3]||(t[3]=b(i=>s.currentTab="table",["stop","prevent"]))},"Table",2)]),e("li",vs,[e("a",{class:D(["nav-link px-2 px-lg-3",{active:s.currentTab==="misc"}]),href:"#",onClick:t[4]||(t[4]=b(i=>s.currentTab="misc",["stop","prevent"]))},"Misc",2)])]),p(e("div",null,[e("div",ks,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"storeOnControlEnter","onUpdate:modelValue":t[5]||(t[5]=i=>o.settings.storeOnControlEnter=i)},null,512),[[$,o.settings.storeOnControlEnter]]),xs]),e("div",Cs,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"clearTimeLogOnStore","onUpdate:modelValue":t[6]||(t[6]=i=>o.settings.clearTimeLogOnStore=i)},null,512),[[$,o.settings.clearTimeLogOnStore]]),Ss]),e("div",Ds,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showParsePreviewOnType","onUpdate:modelValue":t[7]||(t[7]=i=>o.settings.showParsePreviewOnType=i)},null,512),[[$,o.settings.showParsePreviewOnType]]),Ts]),e("div",$s,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showHelpIcon","onUpdate:modelValue":t[8]||(t[8]=i=>o.settings.showHelpIcon=i)},null,512),[[$,o.settings.showHelpIcon]]),Is])],512),[[F,s.currentTab==="input"]]),p(e("div",null,[n.sync.hasCredentials?f("",!0):(l(),c("p",Ls," Set up sync credentials first to enable sync features ")),e("div",{class:D({"opacity-25":!n.sync.hasCredentials})},[e("div",Fs,[p(e("input",{disabled:!n.sync.hasCredentials,class:"form-check-input setting",type:"checkbox",value:"",id:"syncEnabled","onUpdate:modelValue":t[9]||(t[9]=i=>o.settings.syncEnabled=i)},null,8,Rs),[[$,o.settings.syncEnabled]]),Ms]),e("div",Es,[p(e("input",{disabled:!n.sync.hasCredentials,class:"form-check-input setting",type:"checkbox",value:"",id:"syncSettings","onUpdate:modelValue":t[10]||(t[10]=i=>o.settings.syncSettings=i)},null,8,Us),[[$,o.settings.syncSettings]]),js]),e("div",Ps,[Vs,e("div",Os,[e("div",Bs,[p(e("input",{disabled:!n.sync.hasCredentials,id:"checkForUpdateIntervalMinutes",class:"form-control form-control-sm",min:"0",max:"240",type:"number","onUpdate:modelValue":t[11]||(t[11]=i=>o.settings.checkForUpdateIntervalMinutes=i)},null,8,As),[[k,o.settings.checkForUpdateIntervalMinutes,void 0,{number:!0}]])]),e("div",Hs,[p(e("input",{disabled:!n.sync.hasCredentials,type:"range",class:"form-range",min:"0",max:"240","onUpdate:modelValue":t[12]||(t[12]=i=>o.settings.checkForUpdateIntervalMinutes=i)},null,8,zs),[[k,o.settings.checkForUpdateIntervalMinutes,void 0,{number:!0}]])])])])],2)],512),[[F,s.currentTab==="sync"]]),p(e("div",null,[e("div",Ns,[qs,e("div",Ys,[e("div",Ks,[p(e("input",{id:"defaultDuration",class:"form-control form-control-sm",min:"5",max:"240",type:"number","onUpdate:modelValue":t[13]||(t[13]=i=>o.settings.defaultDuration=i)},null,512),[[k,o.settings.defaultDuration,void 0,{number:!0}]])]),e("div",Qs,[p(e("input",{type:"range",class:"form-range",min:"5",max:"240","onUpdate:modelValue":t[14]||(t[14]=i=>o.settings.defaultDuration=i)},null,512),[[k,o.settings.defaultDuration,void 0,{number:!0}]])])])]),e("div",Js,[Gs,e("div",Ws,[e("div",Zs,[p(e("input",{id:"hourThreshold",class:"form-control form-control-sm",min:"1",max:"24",type:"number","onUpdate:modelValue":t[15]||(t[15]=i=>o.settings.hourThreshold=i)},null,512),[[k,o.settings.hourThreshold,void 0,{number:!0}]])]),e("div",Xs,[p(e("input",{type:"range",class:"form-range",min:"1",max:"24","onUpdate:modelValue":t[16]||(t[16]=i=>o.settings.hourThreshold=i)},null,512),[[k,o.settings.hourThreshold,void 0,{number:!0}]])])])]),e("div",tn,[e("label",en,"Default rate ("+h(o.util.formatAmount(o.settings.defaultRate,o.settings.currencyFormat))+"):",1),e("div",sn,[e("div",nn,[p(e("input",{id:"defaultRate",class:"form-control form-control-sm",min:"0",max:"1000",type:"number","onUpdate:modelValue":t[17]||(t[17]=i=>o.settings.defaultRate=i)},null,512),[[k,o.settings.defaultRate,void 0,{number:!0}]])]),e("div",on,[p(e("input",{type:"range",class:"form-range",min:"0",max:"1000","onUpdate:modelValue":t[18]||(t[18]=i=>o.settings.defaultRate=i)},null,512),[[k,o.settings.defaultRate,void 0,{number:!0}]])])])]),e("div",rn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"rateIncludesTax","onUpdate:modelValue":t[19]||(t[19]=i=>o.settings.rateIncludesTax=i)},null,512),[[$,o.settings.rateIncludesTax]]),an]),e("div",ln,[dn,e("div",cn,[e("div",un,[p(e("input",{id:"tax",class:"form-control form-control-sm",min:"0",max:"100",step:"0.1",type:"number","onUpdate:modelValue":t[20]||(t[20]=i=>o.settings.tax=i)},null,512),[[k,o.settings.tax,void 0,{number:!0}]])]),e("div",hn,[p(e("input",{type:"range",class:"form-range",min:"0",max:"100",step:"0.1","onUpdate:modelValue":t[21]||(t[21]=i=>o.settings.tax=i)},null,512),[[k,o.settings.tax,void 0,{number:!0}]])])])]),e("div",pn,[mn,p(e("input",{type:"text",class:D(["form-control",{"is-invalid":!s.dateFormatIsValid}]),id:"dateFormat","onUpdate:modelValue":t[22]||(t[22]=i=>o.settings.dateFormat=i)},null,2),[[k,o.settings.dateFormat]])]),e("div",gn,[fn,p(e("input",{type:"text",class:D(["form-control",{"is-invalid":!s.currencyIsValid}]),id:"currencyFormat","onUpdate:modelValue":t[23]||(t[23]=i=>o.settings.currencyFormat=i)},null,2),[[k,o.settings.currencyFormat]])]),e("div",_n,[bn,p(e("input",{type:"text",class:"form-control",id:"defaultProject","onUpdate:modelValue":t[24]||(t[24]=i=>o.settings.defaultProject=i)},null,512),[[k,o.settings.defaultProject]]),o.settings.defaultProject?(l(),c("span",{key:0,class:"position-absolute end-0 top-50 translate-middle btn btn-sm btn-close pe-0",onClick:t[25]||(t[25]=i=>o.settings.defaultProject="")})):f("",!0)]),e("div",yn,[wn,p(e("input",{type:"text",class:"form-control",id:"defaultClient","onUpdate:modelValue":t[26]||(t[26]=i=>o.settings.defaultClient=i)},null,512),[[k,o.settings.defaultClient]]),o.settings.defaultClient?(l(),c("span",{key:0,class:"position-absolute end-0 top-50 translate-middle btn btn-sm btn-close pe-0",onClick:t[27]||(t[27]=i=>o.settings.defaultClient="")})):f("",!0)]),e("div",vn,[kn,p(e("input",{type:"text",class:"form-control",id:"defaultTask","onUpdate:modelValue":t[28]||(t[28]=i=>o.settings.defaultTask=i)},null,512),[[k,o.settings.defaultTask]]),o.settings.defaultTask?(l(),c("span",{key:0,class:"position-absolute end-0 top-50 translate-middle btn btn-sm btn-close pe-0",onClick:t[29]||(t[29]=i=>o.settings.defaultTask="")})):f("",!0)]),e("div",xn,[Cn,p(e("input",{type:"text",class:"form-control",id:"defaultSource","onUpdate:modelValue":t[30]||(t[30]=i=>o.settings.defaultSource=i)},null,512),[[k,o.settings.defaultSource]]),o.settings.defaultSource?(l(),c("span",{key:0,class:"position-absolute end-0 top-50 translate-middle btn btn-sm btn-close pe-0",onClick:t[31]||(t[31]=i=>o.settings.defaultSource="")})):f("",!0)])],512),[[F,s.currentTab==="timelogs"]]),p(e("div",null,[e("div",Sn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showCostColumn","onUpdate:modelValue":t[32]||(t[32]=i=>o.settings.showCostColumn=i)},null,512),[[$,o.settings.showCostColumn]]),Dn]),e("div",Tn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showProjectColumn","onUpdate:modelValue":t[33]||(t[33]=i=>o.settings.showProjectColumn=i)},null,512),[[$,o.settings.showProjectColumn]]),$n]),e("div",In,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showClientColumn","onUpdate:modelValue":t[34]||(t[34]=i=>o.settings.showClientColumn=i)},null,512),[[$,o.settings.showClientColumn]]),Ln]),e("div",Fn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showTaskColumn","onUpdate:modelValue":t[35]||(t[35]=i=>o.settings.showTaskColumn=i)},null,512),[[$,o.settings.showTaskColumn]]),Rn]),e("div",Mn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showSourceColumn","onUpdate:modelValue":t[36]||(t[36]=i=>o.settings.showSourceColumn=i)},null,512),[[$,o.settings.showSourceColumn]]),En]),e("div",Un,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"showDupeButton","onUpdate:modelValue":t[37]||(t[37]=i=>o.settings.showDupeButton=i)},null,512),[[$,o.settings.showDupeButton]]),jn])],512),[[F,s.currentTab==="table"]]),p(e("div",null,[e("div",Pn,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"keepOriginalLogOnEdit","onUpdate:modelValue":t[38]||(t[38]=i=>o.settings.keepOriginalLogOnEdit=i)},null,512),[[$,o.settings.keepOriginalLogOnEdit]]),Vn]),e("div",On,[Bn,p(e("input",{type:"text",class:D(["form-control",{"is-invalid":!s.dateRangeFormatIsValid}]),id:"dateRangeFormat","onUpdate:modelValue":t[39]||(t[39]=i=>o.settings.dateRangeFormat=i)},null,2),[[k,o.settings.dateRangeFormat]])]),e("div",An,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:"closeFiltersOnApply","onUpdate:modelValue":t[40]||(t[40]=i=>o.settings.closeFiltersOnApply=i)},null,512),[[$,o.settings.closeFiltersOnApply]]),Hn]),e("div",zn,[Nn,p(e("input",{type:"text",class:"form-control",id:"filenameTemplate","onUpdate:modelValue":t[41]||(t[41]=i=>o.settings.filenameTemplate=i)},null,512),[[k,o.settings.filenameTemplate]])]),e("div",qn,[Yn,p(e("input",{type:"text",class:"form-control",id:"deviceName","onUpdate:modelValue":t[42]||(t[42]=i=>o.settings.deviceName=i)},null,512),[[k,o.settings.deviceName]])]),e("div",Kn,[Qn,p(e("input",{type:"text",class:"form-control",id:"deviceId","onUpdate:modelValue":t[43]||(t[43]=i=>o.settings.deviceId=i),readonly:""},null,512),[[k,o.settings.deviceId]])])],512),[[F,s.currentTab==="misc"]]),e("div",Jn,[e("button",{class:"btn btn-primary",onClick:t[44]||(t[44]=(...i)=>o.saveSettings&&o.saveSettings(...i))}," Save settings ")])])])])],512)}var Wn=v(os,[["render",Gn]]);class q{constructor(t,n){S(this,"data",[]);S(this,"index",{});S(this,"transactions",[]);S(this,"timelogParser");S(this,"transactionItemLimit",16);S(this,"options");S(this,"currentTransaction",null);this.options=n,this.timelogParser=t;let a=this.options.storage.get("data",[]);a.length>0&&a[0]!==null&&"day"in a[0]&&(console.log("purging old version data..."),this.options.storage.set("data",[]),a=[]),a&&(this.data=a);let s=this.options.storage.get("transactions");s&&(this.transactions=s),this.transactions.length>0&&!this.transactions[this.transactions.length-1].committedAt&&(this.currentTransaction=this.transactions[this.transactions.length-1]),this.makeIndex()}checkIntegrity(){if(this.data.length>0&&this.transactions.length===0&&!this.currentTransaction&&this.data.length>0)this.data.forEach(t=>this.addToTransaction(t)),this.commit(!0);else if(this.transactions.length>0&&this.data.length===0){this.commit(!1);let t=this.transactions.slice();this.transactions=[],this.mergeTransactions(t)}}makeIndex(){const t={};for(let n=this.data.length-1;n>=0;n--)t[this.data[n].timestamp]=Math.max(t[this.data[n].timestamp]||-1/0,n);this.index=t}findIndexByDate(t){let n=t in this.index?this.index[t]:this.data.length-1;if(t in this.index)return this.index[t]+1;if(this.data.length>0&&t>this.data[this.data.length-1].timestamp)return this.data.length;if(this.data.length>0&&t<this.data[0].timestamp)return 0;for(let a=n;a>=0;a--)if(this.data[a]&&t>=this.data[a].timestamp)return a===this.data.length-1?a-1:a+1;return 0}findTimelogIndex(t){if(this.data.length===1)return 0;let n=this.findIndexByDate(t.timestamp);if(this.data[n]&&this.data[n].hash===t.hash)return n;for(let a=n;a>=0;a--)if(this.data[a]&&this.data[a].hash===t.hash)return a;return!1}addToTransaction(t,n="insert"){if(this.currentTransaction||this.createTransaction(),this.currentTransaction.operations.hasOwnProperty(n)||(this.currentTransaction.operations[n]=[]),n==="update"){let s=!1,o=["insert","update"];t:for(let i of o)if(i in this.currentTransaction.operations){for(let d=0;d<this.currentTransaction.operations[i].length;d++)if(this.currentTransaction.operations[i][d].indexOf(t.hash)===1){this.currentTransaction.operations[i].splice(d,1,t.normalized),s=!0;break t}}s||this.currentTransaction.operations.update.push(t.normalized)}else if(n==="delete"){let s={insert:!1,update:!1},o=["insert","update"];for(let i of o)if(i in this.currentTransaction.operations){for(let d=0;d<this.currentTransaction.operations[i].length;d++)if(this.currentTransaction.operations[i][d].indexOf(t.hash)===1){this.currentTransaction.operations[i].splice(d,1),s[i]=!0;break}}s.insert||this.currentTransaction.operations.delete.push(t.normalized)}else n==="insert"&&this.currentTransaction.operations.insert.push(t.normalized);let a=0;for(const s in this.currentTransaction.operations)a+=this.currentTransaction.operations[s].length;return a>=this.transactionItemLimit&&(this.commit(),this.options.storeFunction()),!0}insert(t,n=!1){const a=this.findIndexByDate(t.timestamp);return this.data.splice(a,0,t),n||this.addToTransaction(t),this.store(),!0}store(){this.makeIndex(),this.storeTransactions(),this.options.storage.set("data",this.data)}delete(t,n=!1){const a=this.findTimelogIndex(t);return typeof a=="number"&&(this.data.splice(a,1),n||this.addToTransaction(t,"delete")),this.store(),!0}update(t,n=!1){const a=this.findTimelogIndex(t);return typeof a=="number"&&(this.data[a]=t,n||this.addToTransaction(t,"update")),this.store(),!0}storeTransactions(){this.transactions.sort((t,n)=>(t.committedAt||1e13)-(n.committedAt||1e13)),this.options.storage.set("transactions",this.transactions)}commit(t=!1){if(this.currentTransaction){for(const n in this.currentTransaction.operations)this.currentTransaction.operations[n].length===0&&delete this.currentTransaction.operations[n];this.currentTransaction.committedAt=Date.now()+this.transactions.length,t&&this.storeTransactions(),this.currentTransaction=!1;return}t&&this.storeTransactions()}createTransaction(){let t=Date.now();this.currentTransaction={hash:this.options.util.hash(16),createdAt:t,committedAt:!1,operations:{},origin:this.options.deviceId},this.transactions.push(this.currentTransaction)}mergeTransaction(t){this.currentTransaction&&this.commit(!0);for(let n=0;n<this.transactions.length;n++)if(this.transactions[n].hash===t.hash)return!1;return this.transactions.unshift(t),Object.keys(t.operations).forEach(n=>{t.operations[n].forEach(a=>{typeof a=="string"&&(a=this.timelogParser.parse(a)),this[n](a,!0)})}),this.storeTransactions(),!0}mergeTransactions(t){let n=0;for(let a=0;a<t.length;a++)n+=this.mergeTransaction(t[a])?1:0;return n}get(t,n,a){let s=null,o=null;t.setHours(0),n.setHours(23.9);const i={lower:t,upper:n},d={},m={clients:[],projects:[],sources:[],tasks:[]};if(this.data.length>0&&this.data[this.data.length-1].timestamp>=i.lower&&this.data[0].timestamp<=i.upper){for(let C=this.data.length-1;C>=0&&(this.data[C].timestamp<=i.upper&&!s&&(s=C),!(this.data[C].timestamp<i.lower));C--)o=C;const _=this.data.slice(o,s+1).reverse(),g=!a||!Object.values(a).some(C=>C.length>0);_.filter(C=>g||this.filter(a,C)).forEach(C=>{const I=C.timestamp;I in d||(d[I]={date:new Date(I),total:0,cost:0,logs:[]}),d[I].total+=C.duration,d[I].cost+=C.cost,d[I].logs.push(C),Object.keys(m).forEach(y=>m[y].push(...C[y]))})}return Object.keys(m).forEach(_=>m[_]=[...new Set(m[_])]),{matchedProperties:m,days:Object.values(d),range:i}}slice(t=0,n=10,a){const s=new Date,o={date:s,logs:this.data.slice().reverse().slice(t,n),total:0,cost:0};return{days:{[0]:o},matchedProperties:{clients:[],projects:[],sources:[],tasks:[]},range:{}}}filter(t,n){for(const a in t)if(t[a].length>0&&!n[a].some(s=>t[a].includes(s)))return!1;return!0}}const Zn={inject:["settings","util"],name:"InspectDialog",props:{timelogStore:q},data(){return{view:"transactions",transactionIndex:0,modal:null}},mounted(){this.modal=new O(this.$refs.modal),this.$refs.modal.addEventListener("shown.bs.modal",r=>this.view="transactions"),this.$refs.modal.addEventListener("hidden.bs.modal",r=>this.view=null)},methods:{showTransaction(r){this.view="detail",this.transactionIndex=this.timelogStore.transactions.length-r-1},show(){this.modal.show()}}},Xn={class:"modal fade",ref:"modal",id:"inspectDataModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"inspectDataModalLabel","aria-hidden":"true"},to={class:"modal-dialog modal-lg modal-dialog-scrollable modal-fullscreen-md-down"},eo={class:"modal-content"},so=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"inspectDataModalLabel"},"Inspect local data"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),no={class:"modal-body"},oo={key:0},io={class:"table-sm table"},ro=e("td",null,"Hash",-1),ao=e("td",null,"device",-1),lo=e("td",null,"created",-1),co=e("td",null,"committed",-1),uo={key:0},ho={key:0},po={class:"list-group list-group-flush"},mo={class:"list-group-item"},go={key:1,class:"table-responsive"},fo=e("h5",null,"Transactions",-1),_o={class:"table table-sm table-hover"},bo=e("thead",null,[e("tr",null,[e("th",null," hash "),e("th",null," origin "),e("th",null," created "),e("th",null," committed "),e("th",null," inserts "),e("th",null," updates "),e("th",null," deletes ")])],-1),yo=["onClick"],wo={key:0};function vo(r,t,n,a,s,o){return l(),c("div",Xn,[e("div",to,[e("div",eo,[so,e("div",no,[s.view==="detail"?(l(),c("div",oo,[e("button",{class:"btn btn-link",onClick:t[0]||(t[0]=i=>s.view="transactions")},"back "),e("table",io,[e("tbody",null,[e("tr",null,[ro,e("td",null,h(n.timelogStore.transactions[s.transactionIndex].hash),1)]),e("tr",null,[ao,e("td",null,h(n.timelogStore.transactions[s.transactionIndex].origin===o.settings.deviceId?"this device":String(n.timelogStore.transactions[s.transactionIndex].origin).slice(0,4)+"..."),1)]),e("tr",null,[lo,e("td",null,h(o.util.formatDate(n.timelogStore.transactions[s.transactionIndex].createdAt,o.settings.dateFormat)),1)]),e("tr",null,[co,e("td",null,[n.timelogStore.transactions[s.transactionIndex].committedAt?(l(),c("span",uo,h(o.util.formatDate(n.timelogStore.transactions[s.transactionIndex].committedAt,o.settings.dateFormat)),1)):(l(),c("a",{key:1,href:"#",onClick:t[1]||(t[1]=b(i=>n.timelogStore.commit(!0),["stop","prevent"]))},"commit"))])])])]),(l(),c(T,null,L(["insert","delete","update"],(i,d)=>(l(),c(T,null,[i in n.timelogStore.transactions[s.transactionIndex].operations?(l(),c("div",ho,[e("h5",null,h(i),1),e("ul",po,[(l(!0),c(T,null,L(n.timelogStore.transactions[s.transactionIndex].operations[i],(m,_)=>(l(),c("li",mo,[e("pre",null,[e("code",null,h(m),1)])]))),256))])])):f("",!0)],64))),64))])):f("",!0),s.view==="transactions"?(l(),c("div",go,[fo,e("table",_o,[bo,e("tbody",null,[(l(!0),c(T,null,L(n.timelogStore.transactions.slice().reverse(),(i,d)=>(l(),c("tr",{onClick:m=>o.showTransaction(d),class:"cursor-pointer"},[e("td",null,h(i.hash.slice(0,4)+"..."),1),e("td",null,h(i.origin===o.settings.deviceId?"this device":String(i.origin).slice(0,4)+"..."),1),e("td",null,h(o.util.formatDate(i.createdAt,o.settings.dateFormat)),1),e("td",null,[i.committedAt?(l(),c("span",wo,h(o.util.formatDate(i.committedAt,o.settings.dateFormat)),1)):(l(),c("a",{key:1,href:"#",onClick:t[2]||(t[2]=b(m=>n.timelogStore.commit(!0),["stop","prevent"]))},"commit"))]),e("td",null,h(i.operations.insert?i.operations.insert.length:0),1),e("td",null,h(i.operations.update?i.operations.update.length:0),1),e("td",null,h(i.operations.delete?i.operations.delete.length:0),1)],8,yo))),256))])])])):f("",!0)])])])],512)}var ko=v(Zn,[["render",vo]]);const xo={inject:["globalStore"],name:"ToastBox"},Co={class:"toast-container position-fixed bottom-0 start-50 translate-middle-x",style:{"z-index":"8192"}},So={class:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},Do={class:"toast-header"},To={class:"me-auto"},$o={key:0,class:"toast-body"};function Io(r,t,n,a,s,o){return l(),c("div",Co,[(l(!0),c(T,null,L(o.globalStore.toasts,i=>(l(),c("div",So,[e("div",Do,[e("strong",To,h(i.title),1)]),i.body?(l(),c("div",$o,h(i.body),1)):f("",!0)]))),256))])}var Lo=v(xo,[["render",Io]]);const Fo={props:{sync:H}},Ro={class:"offcanvas offcanvas-end",tabindex:"-1",id:"offcanvasControls","aria-labelledby":"offcanvasControlsLabel"},Mo=e("div",{class:"offcanvas-header pb-2 pb-lg-3"},[e("h5",{class:"offcanvas-title",id:"offcanvasControlsLabel"}),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),Eo={class:"offcanvas-body pt-0 pt-lg-3"},Uo={class:"list-group list-group-flush mb-2 pb-2 border-bottom"},jo={class:"list-group list-group-flush mb-2 pb-2 border-bottom"},Po={class:"list-group list-group-flush"};function Vo(r,t,n,a,s,o){return l(),c("div",Ro,[Mo,e("div",Eo,[e("div",Uo,[e("a",{href:"#",class:"list-group-item list-group-item-action",onClick:t[0]||(t[0]=b(i=>r.$emit("show-settings"),["stop","prevent"]))},"Settings")]),e("div",jo,[e("a",{href:"#",class:"list-group-item list-group-item-action",onClick:t[1]||(t[1]=b(i=>r.$emit("show-sync-options"),["stop","prevent"]))},"Sync options"),e("a",{href:"#",class:D(["list-group-item list-group-item-action",{disabled:!n.sync.hasCredentials}]),onClick:t[2]||(t[2]=b(i=>r.$emit("sync-now"),["stop","prevent"]))},"Sync Now",2),e("a",{href:"#",class:"list-group-item list-group-item-action",onClick:t[3]||(t[3]=b(i=>r.$emit("inspect-data"),["stop","prevent"]))},"Inspect Sync Data")]),e("div",Po,[e("a",{href:"#",class:"list-group-item list-group-item-action",onClick:t[4]||(t[4]=b(i=>r.$emit("show-import-dialog"),["stop","prevent"]))},"Import / Export"),e("a",{href:"#",class:"list-group-item list-group-item-action",onClick:t[5]||(t[5]=b(i=>r.$emit("show-help-dialog"),["stop","prevent"]))},"Help & Howto")])])])}var Oo=v(Fo,[["render",Vo]]);class rt{constructor(){S(this,"dateRegExpCache",{});S(this,"internalFormat","yyyy-mm-dd")}lzp(t){return("0"+t).slice(-2)}formatRange(t,n,a){t=t instanceof Date?t:new Date(t),n=n instanceof Date?n:new Date(n);const s=this.lzp(t.getDate()),o=this.lzp(t.getMonth()+1),i=String(t.getFullYear()),d=this.lzp(n.getDate()),m=this.lzp(n.getMonth()+1),_=String(n.getFullYear()),g=i!==_,C=o!==m,I=a.indexOf("mm?")>-1,y=a.indexOf("yyyy?")>-1;let R=a.replace("dd",s);return R=R.replace(/mm\??/,I?C?o:"":o).replace(/yyyy\??/,y?g?i:"":i),R=R.replace("dd",d).replace("mm",m).replace("yyyy",_),R.replace(/^[^\d]+/,"").replace(/([^\d])\1+/g,"$1")}convertFormattedString(t,n,a){return this.formatDate(this.dateFromFormattedString(t,n),a)}findFormattedDateInString(t,n){const a=t.match(this.formatRegExps(n).formatMatchRegExp);if(a&&a.length>=2)return a[0]}convertFormattedDateInString(t,n,a){const s=this.findFormattedDateInString(t,n);return s?t.replace(s,this.formatDate(this.dateFromFormattedString(s,n),a)):t}formatDate(t,n="yyyy-mm-dd"){t=t instanceof Date?t:new Date(t);let a={dd:this.lzp(t.getDate()),d:String(t.getDate()),mm:this.lzp(t.getMonth()+1),m:String(t.getMonth()+1),yyyy:String(t.getFullYear()),yy:String(parseInt(String(t.getFullYear()).slice(-2)))};for(const s in a){const o=new RegExp(`\\b${s}\\b`);n=n.replace(o,a[s])}return n}escapeRegExp(t){return t.replace(/[.*+?^${}()|\/[\]\\]/g,"\\$&")}findDateInString(t){return t.match(this.formatRegExps().dateMatchRegExp)}formatRegExps(t){if(t||(t=this.internalFormat),t in this.dateRegExpCache)return this.dateRegExpCache[t];let n=this.escapeRegExp([...new Set(t.replace(/\w/g,"").split(""))].join("")),a=new RegExp(`(?<![+:\\d]|[\\/@%#]\\w+)(:([-|+]?[\\w\\d${n}]{1,10}))`),s=new RegExp("^"+this.escapeRegExp(t).replace(/dd?/,"(\\d\\d?)").replace(/mm?/,"(\\d\\d?)").replace(new RegExp(`(${n})(y{2,4})`),"$1?$2").replace(new RegExp(`(y{2,4})(${n})`),"$1$2?").replace(/y{2,4}/,"(\\d{4})?")+"$"),o=new RegExp("("+this.escapeRegExp(t).replace(/dd?/,"\\d\\d?").replace(/mm?/,"\\d\\d?").replace(new RegExp(`(${n})(y{2,4})`),"$1?$2").replace(new RegExp(`(y{2,4})(${n})`),"$1$2?").replace(/y{2,4}/,"(\\d{4})?")+")"),i=[["d",t.indexOf("d")],["m",t.indexOf("m")],["y",t.indexOf("y")]];return i.sort((d,m)=>d[1]-m[1]),i=i.map((d,m)=>[d[0],m]),this.dateRegExpCache[t]={formatMatchRegExp:o,dateMatchRegExp:a,actualDateMatchRegExp:s,indexes:i.reduce((d,m)=>(d[m[0]]=m[1],d),{})},this.dateRegExpCache[t]}dateFromFormattedString(t,n){let a=this.formatRegExps(n||this.internalFormat),s=t.match(a.actualDateMatchRegExp);if(s){let o=Number(s[a.indexes.y+1]||new Date().getFullYear()),i=Number(s[a.indexes.m+1])-1,d=Number(s[a.indexes.d+1]);return new Date(o,i,d)}return new Date}parseDuration(t,n,a){if(t.slice(0,1)==="+"&&(t=t.slice(1)),/^\d\d?\d?$/.test(t)){const s=parseInt(t);return s<=a?s*60:s}if(/\d{0,2}:\d{1,2}/.test(t)){let[s,o]=t.split(":");return s=s?parseInt(s):0,o=o?parseInt(o):0,s*60+o}if(/\d{0,2}\.\d{1,2}/.test(t)){let[s,o]=t.split("."),i=o.slice(0,1)==="0";return s=s?parseInt(s):0,o=o?parseInt(o):0,o<10&&!i&&(o=o*10),o=o/100,s*60+Math.round(60*o)}return n}parseDate(t,n){t=String(t),t.slice(0,1)===":"&&(t=t.slice(1));const a=864e5,s=["sun","mon","tue","wed","thu","fri","sat"],o=new RegExp(`^(last|next)?(${s.join("|")})$`),i=new Date;t=t?String(t).trim():"";let d;if(["y","yesterday"].indexOf(t)>-1&&(t="-1"),o.test(t)){const m=i.getDay(),_=s.indexOf(t.slice(-3)),g=t.slice(0,4),C=g==="last"?-7:g==="next"?7:0,I=_-m+C;I>-1?t="+"+I:t=String(I)}return/^[-|+]\d+$/.test(t)?d=new Date(Date.now()+parseInt(t)*a):n&&this.formatRegExps(n).actualDateMatchRegExp.test(t)?d=this.dateFromFormattedString(t,n):d=i,d.setHours(0),d.setMinutes(0),d.setSeconds(0),d.setMilliseconds(0),d}}class B{constructor(t={}){S(this,"options",{defaultDuration:30,hourThreshold:5,defaultRate:255,defaultClient:"",defaultProject:"",defaultTask:"",defaultSource:""});S(this,"prefixes",{"@":"clients","#":"tasks","%":"projects","/":"sources"});S(this,"dateTimeHelper");S(this,"version","1.0.0");S(this,"propertyMatcherRegExp");S(this,"durationMatchRegexp",/\+([\d:.]{1,5})/);this.options=U(U({},this.options),t),this.dateTimeHelper=new rt,this.propertyMatcherRegExp=new RegExp(`([${Object.keys(this.prefixes).map(n=>this.options.util.escapeRegExp(n)).join("|")}])([a-zA-Z0-9:_-]+)`,"g"),this.propertyMatcherRegExp=new RegExp("([/#@%])([a-zA-Z0-9:_-]+)","g")}removePropertyFromString(t,n){n=this.options.util.escapeRegExp(n);const a=new RegExp("^"+n+"$|[^\\w]"+n+"[^\\w]|^"+n+"[^\\w]|[^\\w]"+n+"$","ig");return t.replace(a," ")}parse(t,n=!1){let a=n,s=this.dateTimeHelper.parseDate();t=this.dateTimeHelper.convertFormattedDateInString(t,"yyyy-mm-dd",this.options.dateFormat),t=t.replace(/&\s*/,""),/^~[a-f0-9]{16}/.test(t)&&(a=t.slice(1,16),t=t.replace(/~[a-f0-9]{16}/,""));const o=t.match(this.dateTimeHelper.formatRegExps(this.options.dateFormat).dateMatchRegExp);o&&(s=this.dateTimeHelper.parseDate(o[2],this.options.dateFormat),t=t.replace(o[0]," "));const i=t.matchAll(this.propertyMatcherRegExp),d={timestamp:+s,hash:a||this.options.util.hash(8),clients:[],tasks:[],description:t,sources:[],projects:[],duration:this.options.defaultDuration,normalized:"",cost:0,rate:this.options.defaultRate,parserVersion:this.version};Array.from(i).forEach(g=>{d[this.prefixes[g[1]]].push(g[2]),d.description=this.removePropertyFromString(d.description,g[0])}),d.clients.length===0&&this.options.defaultClient&&(d.clients=[this.options.defaultClient]),d.projects.length===0&&this.options.defaultProject&&(d.projects=[this.options.defaultProject]),d.tasks.length===0&&this.options.defaultTask&&(d.tasks=[this.options.defaultTask]),d.sources.length===0&&this.options.defaultSource&&(d.sources=[this.options.defaultSource]);const m=t.match(this.durationMatchRegexp);m&&(d.duration=this.dateTimeHelper.parseDuration(m[0].slice(1),this.options.defaultDuration,this.options.hourThreshold),d.description=d.description.replace(m[0]," "));const _=t.match(/\$(\$?)([\d.]{1,6})/);return _?(_[1]==="$"?(d.cost=parseFloat(_[2]),d.rate=null):(d.rate=parseFloat(_[2]),d.cost=this.options.util.costFromRate(d.duration,d.rate)),d.description=this.removePropertyFromString(d.description,_[0])):d.cost=this.options.util.costFromRate(d.duration,this.options.defaultRate),["clients","projects","sources","tasks"].forEach(g=>{d[g].length>1&&(d[g]=[...new Set(d[g])])}),d.normalized=this.normalize(d),d.description=d.description.replace(/^~[a-f0-9]*\s?/,""),d.description=d.description.trim(),d}normalize(t){return["~"+t.hash,"+"+this.options.util.formatDuration(t.duration),":"+this.options.util.formatDate(t.timestamp),t.clients.length>0?"@"+t.clients.join(" @"):null,t.projects.length>0?"%"+t.projects.join(" %"):null,t.sources.length>0?"/"+t.sources.join(" /"):null,t.tasks.length>0?"#"+t.tasks.join(" #"):null,t.rate!==this.options.defaultRate&&t.rate!==null?"$"+String(t.rate):null,t.rate===null?"$$"+t.cost:null,t.description].filter(n=>!!n).join(" ").replace(/[ ]{2,}/g," ")}decoratedParse(t){const n=this.parse(t),a=t.match(/&\s*$/);return N(U({},n),{usesDefaultClient:n.clients.length===1&&n.clients[0]===this.options.defaultClient&&t.indexOf(n.clients[0])<0,usesDefaultProject:n.projects.length===1&&n.projects[0]===this.options.defaultProject&&t.indexOf(n.projects[0])<0,usesDefaultTask:n.tasks.length===1&&n.tasks[0]===this.options.defaultTask&&t.indexOf(n.tasks[0])<0,usesDefaultSource:n.sources.length===1&&n.sources[0]===this.options.defaultSource&&t.indexOf(n.sources[0])<0,usesDefaultDuration:!t.match(this.durationMatchRegexp),usesDefaultDate:!t.match(this.dateTimeHelper.formatRegExps(this.options.dateFormat).dateMatchRegExp),usesDefaultRate:!t.match(/\$\d+/),isTimer:a})}}class Y{set(t,n){typeof n!="string"&&(n=JSON.stringify(n)),window.localStorage.setItem(t,n)}get(t,n=!1){const a=window.localStorage.getItem(t);return a&&['"',"{","["].indexOf(a[0])>-1?JSON.parse(a):a||n}remove(t){return window.localStorage.removeItem(t),!0}}class K{constructor(t){S(this,"data",{});S(this,"logStore");S(this,"storage");this.logStore=t,this.storage=new Y,this.data=this.storage.get("suggestions"),this.data||(this.data={},this.rebuild())}get(t,n,a=10){let s=[];for(let o=0;o<this.data[t].length&&(this.data[t][o][0].indexOf(n)===0&&s.push(this.data[t][o][0]),s.length!==a);o++);return s}updateFromLog(t){Object.keys(this.data).forEach(n=>{t[n].forEach(a=>this.insert(n,a))}),this.storage.set("suggestions",this.data)}insert(t,n){for(let a=0;a<this.data[t].length;a++)if(this.data[t][a][0]===n){this.data[t][a][1]++,this.reorder(t);return}this.data[t].push([n,1]),this.reorder(t)}rebuild(){const t={clients:{},projects:{},tasks:{},sources:{}},n=(a,s)=>{if(s in t[a]){t[a][s]++;return}t[a][s]=1};this.logStore.data.forEach(a=>{a.clients.forEach(s=>n("clients",s)),a.tasks.forEach(s=>n("tasks",s)),a.projects.forEach(s=>n("projects",s)),a.sources.forEach(s=>n("sources",s))}),Object.keys(t).forEach(a=>{let s=[];for(const o in t[a])s.push([o,t[a][o]]);this.data[a]=s,this.reorder(a)}),this.storage.set("suggestions",this.data)}reorder(t){this.data[t].sort((n,a)=>a[1]-n[1])}}const Bo={},Ao={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},Ho=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),zo=[Ho];function No(r,t){return l(),c("svg",Ao,zo)}var qo=v(Bo,[["render",No]]);class tt{constructor(t,n){S(this,"timers");S(this,"storage");S(this,"timelogParser");this.storage=t;let a=this.storage.get("timers",[]);this.timers=a.map(s=>N(U({},s),{started:new Date(s.started)})),this.timelogParser=n}getTimers(){return this.timers}setTimer(t){this.timers.unshift({started:new Date,timelog:t,minutes:0,state:"running"}),this.storeTimers()}storeTimers(){this.storage.set("timers",this.timers)}delete(t){t=typeof t=="string"?this.hashToIndex(t):t,this.end(t)}end(t){t=typeof t=="string"?this.hashToIndex(t):t;let n=this.timers[t],a=n.timelog,s=this.duration(n.started);return a.duration=Math.round(s)+n.minutes,a.duration===0&&(a.duration=this.timelogParser.options.defaultDuration),a.normalized=this.timelogParser.normalize(a),this.timers.splice(t,1),this.storeTimers(),a}pause(t){t=typeof t=="string"?this.hashToIndex(t):t,this.timers[t].state="paused",this.timers[t].minutes+=this.duration(this.timers[t].started),this.storeTimers()}unpause(t){t=typeof t=="string"?this.hashToIndex(t):t,this.timers[t].state="running",this.timers[t].started=new Date,this.storeTimers()}toggle(t){this.timers[t].state==="running"?this.pause(t):this.unpause(t)}duration(t){return Math.round((Date.now()-+t)/6e4)}hashToIndex(t){return this.timers.map(n=>n.timelog.hash).indexOf(t)}}const Yo={components:{QuestionMark:qo},inject:["util","globalStore","settings"],props:{parser:B,logStore:q,suggestionProvider:K,timers:tt},data(){return{inputIsMultiple:!1,currentLog:null,placeholder:"",previewString:"",logString:"",suggestMatcher:/([@|#|\/|%])([a-z0-9:_-]{1,})$/mi,suggestions:[],suggestionIndex:0,currentSuggestFragment:null,prefixes:{"@":"clients","#":"tasks","%":"projects","/":"sources"}}},mounted(){this.setPlaceholder()},watch:{logString:function(r,t){this.inputIsMultiple=r.indexOf("----")>-1}},methods:{setPlaceholder(){const r=["what's poppin' kermit?","what do?","what have you been up to?","what's happening?","\u231A\u{1F914}","do you remember anything at all?","any recollection?","think...","something something video call"];this.placeholder=r[Math.floor(Math.random()*r.length)]},keyDown(r){if(["Tab","Enter"].indexOf(r.key)>-1&&this.suggestions.length>0){this.insertSuggestion(),r.preventDefault();return}if(["ArrowDown","ArrowUp"].indexOf(r.key)>-1&&this.suggestions.length>0){const t=this.suggestions.length;let n=parseInt(this.suggestionIndex);r.key==="ArrowDown"?(n++,n>=t&&(n=0)):(n--,n<0&&(n=t-1)),this.suggestionIndex=n,r.preventDefault()}},keyUp(r){const t=this.logString,n=this.$refs.textarea.selectionStart,a=t.substr(0,n),s=Math.max(a.lastIndexOf(" "),0),o=a.substr(s,n),i=o.match(this.suggestMatcher);if(r.key==="Enter"&&r.ctrlKey&&this.settings.storeOnControlEnter){this.storeCurrentLog();return}["ArrowDown","ArrowUp"].indexOf(r.key)>-1&&this.currentSuggestFragment!==null||(i?(this.suggestionIndex=0,this.currentSuggestFragment=i[2],this.suggestions=this.suggestionProvider.get(this.prefixes[i[1]],i[2])):this.unsetSuggestions(),this.setPreview())},setPreview(){if(this.settings.showParsePreviewOnType){const r=this.logString.split("----"),t=this.parser.decoratedParse(r[0]);this.previewString=`
                <span class="${this.currentLog?"d-none":""}">Preview:</span>
                <span class="${this.currentLog?"text-info":"d-none"}">Editing:</span>
                <span class="${t.clients.length===0?"d-none":""} ${t.usesDefaultClient?"fst-italic":""}">${this.util.join(t.clients,"@")}</span>
                <span class="${t.projects.length===0?"d-none":""} ${t.usesDefaultProject?"fst-italic":""}">${this.util.join(t.projects,"%")}</span>
                <span class="${t.tasks.length===0?"d-none":""} ${t.usesDefaultTask?"fst-italic":""}">${this.util.join(t.tasks,"#")}</span>
                <span class="${t.sources.length===0?"d-none":""} ${t.usesDefaultSource?"fst-italic":""}">${this.util.join(t.sources,"/")}</span>
                <span class="${t.usesDefaultDuration?"fst-italic":""}">${this.util.formatDuration(t.duration)}</span>
                <span class="${t.usesDefaultDate?"fst-italic":""}">${this.util.formatDate(t.timestamp,this.settings.dateFormat)}</span>
                <span>${t.description}</span>
            `,r.length>1&&(this.previewString+=`<span class="fw-bold">and ${r.length-1} more</span>`)}},afterProcessing(){this.settings.clearTimeLogOnStore&&(this.logString="",this.previewString=null,this.currentLog=!1,this.inputIsMultiple=!1),this.$emit("reload-table"),this.setPlaceholder(),this.unsetSuggestions()},setTimer(){let r=this.logString.split("----");r[0].trim().length!==0&&(r.forEach(t=>{let n=this.parser.parse(t);this.timers.setTimer(n)}),this.globalStore.toast("timer created..."),this.afterProcessing())},storeCurrentLogAsMultiple(){if(this.logString.length===0)return;let r=this.logString.split("----"),t=0,n=0;r.forEach(a=>{if(a.trim().length===0)return;let s=this.parser.parse(a);/&\s*$/.test(a)?(this.timers.setTimer(s),n++):(this.logStore.insert(s),t++)}),t>0&&this.globalStore.toast(`${t} logs saved...`),n>0&&this.globalStore.toast(`${n} timers created...`),this.afterProcessing()},storeCurrentLog(){if(this.logString.length===0)return;if(!this.currentLog&&this.inputIsMultiple){this.storeCurrentLogAsMultiple();return}if(/&\s*$/.test(this.logString)){this.setTimer();return}let r;this.currentLog?(r=this.parser.parse(this.logString),r.timestamp!==this.currentLog.timestamp?(this.settings.keepOriginalLogOnEdit||this.logStore.delete(this.currentLog),this.logStore.insert(r)):(r=this.parser.parse(this.logString,this.currentLog.hash),this.logStore.update(r)),this.globalStore.toast("log updated...")):(r=this.parser.parse(this.logString),this.logStore.insert(r),this.globalStore.toast("log saved...")),this.suggestionProvider.updateFromLog(r),this.afterProcessing()},insertSuggestion(){const r=this.logString,t=this.$refs.textarea.selectionStart,n=r.substr(0,t),a=n.replace(new RegExp(this.currentSuggestFragment+"$"),this.suggestions[this.suggestionIndex]+" "),s=a.length-n.length;this.suggestions=[],this.suggestionIndex=0,this.currentSuggestFragment=null,this.logString=r.replace(n,a),this.$refs.textarea.selectionStart=t+s,this.$refs.textarea.selectionEnd=t+s,this.$refs.textarea.focus(),this.setPreview()},unsetSuggestions(){this.suggestionIndex=0,this.currentSuggestFragment=null,this.suggestions=[]},editLog(r){this.unsetSuggestions(),this.currentLog=r,this.logString=this.currentLog.normalized.replace(/^~[a-f0-9 ]*/,""),this.logString=this.parser.dateTimeHelper.convertFormattedDateInString(this.logString,"yyyy-mm-dd",this.settings.dateFormat),this.$refs.textarea.focus(),this.$nextTick(()=>{this.setPreview()})}}},et=r=>(wt("data-v-b63dc44e"),r=r(),vt(),r),Ko={class:"row"},Qo={class:"col-12"},Jo={class:"row g-0"},Go={class:"col-9 col-xl-10"},Wo={class:"position-relative"},Zo=["placeholder"],Xo={class:"col-3 col-xl-2"},ti={class:"btn-group w-100 h-100"},ei=et(()=>e("span",{class:"d-none d-lg-inline fs-4"},"Store",-1)),si=et(()=>e("span",{class:"d-lg-none"},"Store",-1)),ni=[ei,si],oi=et(()=>e("button",{type:"button",class:"btn btn-info dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("span",{class:"visually-hidden"},"Toggle Dropdown")],-1)),ii={class:"dropdown-menu"},ri={class:"col-12"},ai=["innerHTML"],li={class:"position-relative"},di={class:"list-group position-absolute top-100 w-100",style:{"z-index":"999"}};function ci(r,t,n,a,s,o){const i=w("QuestionMark");return l(),c("div",Ko,[e("div",Qo,[e("div",Jo,[e("div",Go,[e("div",Wo,[p(e("textarea",{class:"form-control form-control-lg",placeholder:s.placeholder,id:"timelog",style:{height:"100px"},ref:"textarea",onKeydown:t[0]||(t[0]=d=>o.keyDown(d)),onKeyup:t[1]||(t[1]=d=>o.keyUp(d)),"onUpdate:modelValue":t[2]||(t[2]=d=>s.logString=d)},null,40,Zo),[[k,s.logString]]),o.settings.showHelpIcon?(l(),c("button",{key:0,class:"btn btn-icon position-absolute end-0 top-0",onClick:t[3]||(t[3]=d=>r.$emit("show-help"))},[x(i)])):f("",!0)])]),e("div",Xo,[e("div",ti,[e("button",{id:"storeButton",type:"button",class:"btn btn-info w-100 h-100",title:"ctrl + enter",onClick:t[4]||(t[4]=b((...d)=>o.storeCurrentLog&&o.storeCurrentLog(...d),["stop","prevent"]))},ni),oi,e("ul",ii,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[5]||(t[5]=b((...d)=>o.setTimer&&o.setTimer(...d),["prevent","stop"]))},"Start timer")])])])]),e("div",ri,[s.logString.length>0?(l(),c("p",{key:0,class:"small mb-0",innerHTML:s.previewString},null,8,ai)):f("",!0),e("div",li,[e("ul",di,[(l(!0),c(T,null,L(s.suggestions,(d,m)=>(l(),c("li",{class:D(["list-group-item list-group-item-action",{active:m===s.suggestionIndex}]),onClick:t[6]||(t[6]=b((..._)=>o.insertSuggestion&&o.insertSuggestion(..._),["stop","prevent"]))},h(d),3))),256))])])])])])])}var ui=v(Yo,[["render",ci],["__scopeId","data-v-b63dc44e"]]);const hi={},pi={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},mi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"},null,-1),gi=[mi];function fi(r,t){return l(),c("svg",pi,gi)}var _i=v(hi,[["render",fi]]);const bi={},yi={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},wi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"},null,-1),vi=[wi];function ki(r,t){return l(),c("svg",yi,vi)}var xi=v(bi,[["render",ki]]);const Ci={},Si={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},Di=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1),Ti=[Di];function $i(r,t){return l(),c("svg",Si,Ti)}var at=v(Ci,[["render",$i]]);const Ii={},Li={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},Fi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"},null,-1),Ri=[Fi];function Mi(r,t){return l(),c("svg",Li,Ri)}var Ei=v(Ii,[["render",Mi]]);const Ui={},ji={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},Pi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"},null,-1),Vi=[Pi];function Oi(r,t){return l(),c("svg",ji,Vi)}var Bi=v(Ui,[["render",Oi]]);const Ai={},Hi={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},zi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"},null,-1),Ni=[zi];function qi(r,t){return l(),c("svg",Hi,Ni)}var Yi=v(Ai,[["render",qi]]);const Ki={inject:["util","settings"],props:{tableData:{}},data(){let r=this.util.escapeStringForFilename(this.settings.filenameTemplate.replace("%s",this.util.formatDateRangeByFormat(this.tableData.range.lower,this.tableData.range.upper,this.settings.dateRangeFormat)));return{defaultName:r,name:r,cols:{date:!0,clients:!0,projects:!0,tasks:!0,sources:!0,description:!0,cost:this.settings.showCostColumn,rate:this.settings.showCostColumn,duration:!0},modal:null}},computed:{rows(){return this.tableData.days.reduce((r,t)=>{let n=this.util.formatDate(t.date,this.settings.dateFormat);return r.push(...t.logs.map(a=>{let s=[];return this.cols.date&&s.push(n),this.cols.clients&&s.push(this.util.join(a.clients)),this.cols.projects&&s.push(this.util.join(a.projects)),this.cols.tasks&&s.push(this.util.join(a.tasks)),this.cols.sources&&s.push(this.util.join(a.sources)),this.cols.description&&s.push(a.description),this.cols.cost&&s.push(this.util.formatAmount(a.cost,this.settings.currencyFormat)),this.cols.rate&&s.push(this.util.formatAmount(a.rate,this.settings.currencyFormat)+"/hr"),this.cols.duration&&s.push(this.util.formatDuration(a.duration)),s})),r},[this.columnTitles])},columnTitles(){return Object.keys(this.cols).filter(r=>this.cols[r])}},mounted(){this.modal=new O(this.$refs.modal)},methods:{download(r){const t=new X.book_new,n={},a=this.util.escapeStringForFilename(this.name||this.defaultName);r==="csv"&&(n.forceQuotes=!0),t.Props={Title:a,CreatedDate:new Date};let s=X.aoa_to_sheet(this.rows);X.book_append_sheet(t,s,a,!0),kt(t,`${a}.${r}`,n)}}},Qi={class:"modal fade",ref:"modal",id:"download","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"downloadLabel","aria-hidden":"true"},Ji={class:"modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"},Gi={class:"modal-content"},Wi=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"downloadLabel"},"Download"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Zi={class:"modal-body"},Xi={key:0,class:"alert alert-info"},tr={key:1},er={class:"mb-3"},sr=e("label",{for:"filename",class:"form-label"},"Filename",-1),nr={class:"form-check form-switch mb-2"},or=["id","onUpdate:modelValue"],ir=["for"],rr=u(" include "),ar=u(" column "),lr={key:0,class:"modal-footer"};function dr(r,t,n,a,s,o){return l(),c("div",Qi,[e("div",Ji,[e("div",Gi,[Wi,e("div",Zi,[o.rows.length===1?(l(),c("p",Xi,"No rows to download, please adjust the filters.")):(l(),c("div",tr,[e("div",er,[sr,p(e("input",{type:"text",class:"form-control",id:"filename","onUpdate:modelValue":t[0]||(t[0]=i=>s.name=i)},null,512),[[k,s.name]])]),(l(!0),c(T,null,L(s.cols,(i,d)=>(l(),c("div",nr,[p(e("input",{class:"form-check-input setting",type:"checkbox",value:"",id:`col-${d}`,"onUpdate:modelValue":m=>s.cols[d]=m},null,8,or),[[$,s.cols[d]]]),e("label",{class:"form-check-label",for:`col-${d}`},[rr,e("code",null,h(d),1),ar],8,ir)]))),256))]))]),o.rows.length>1?(l(),c("div",lr,[e("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=b(i=>o.download("csv"),["stop","prevent"]))},"CSV"),e("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=b(i=>o.download("xlsx"),["stop","prevent"]))},"XLSX"),e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=b(i=>o.download("ods"),["stop","prevent"]))},"ODS"),e("button",{type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=b(i=>o.download("txt"),["stop","prevent"]))},"TXT")])):f("",!0)])])],512)}var cr=v(Ki,[["render",dr]]);const ur={},hr={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},pr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),mr=[pr];function gr(r,t){return l(),c("svg",hr,mr)}var lt=v(ur,[["render",gr]]);const fr={inject:["settings"],components:{CloseButton:lt},props:{suggestionProvider:K,tableData:{}},mounted(){this.modal=new O(this.$refs.modal)},data(){const r={clients:[],projects:[],tasks:[],sources:[]};return{filterKeys:Object.keys(r),filters:r}},methods:{toggleFilter(r,t,n=!1){this.filters[r].indexOf(t)>-1?this.filters[r].splice(this.filters[r].indexOf(t),1):this.filters[r].push(t),n&&this.apply()},apply(){this.$emit("update-filters",this.filters),this.settings.closeFiltersOnApply&&this.modal.hide()},clear(){this.filters={clients:[],projects:[],tasks:[],sources:[]},this.apply()}}},_r={class:"modal fade",ref:"modal",id:"filters","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"filtersLabel","aria-hidden":"true"},br={class:"modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"},yr={class:"modal-content"},wr=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"filtersLabel"},"Filters"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),vr={class:"modal-body"},kr={class:"accordion",id:"filterAccordion"},xr={key:0,class:"accordion-item"},Cr=["id"],Sr=["data-bs-target","aria-controls"],Dr=["id","aria-labelledby"],Tr={class:"accordion-body"},$r=["for"],Ir=["onChange","checked","id"],Lr=["for"],Fr=["onChange","checked","id"],Rr={class:"modal-footer"};function Mr(r,t,n,a,s,o){return l(),c("div",_r,[e("div",br,[e("div",yr,[wr,e("div",vr,[e("div",kr,[(l(!0),c(T,null,L(s.filterKeys,(i,d)=>(l(),c(T,null,[n.suggestionProvider.data[i].length+n.tableData.matchedProperties[i].length>0?(l(),c("div",xr,[e("h2",{class:"accordion-header",id:`heading${d}`},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse${d}`,"aria-expanded":"false","aria-controls":`collapse${d}`},h(i)+" ("+h(s.filters[i].length)+" / "+h(n.tableData.matchedProperties[i].length)+" ) ",9,Sr)],8,Cr),e("div",{id:`collapse${d}`,class:"accordion-collapse collapse","aria-labelledby":`heading${d}`,"data-bs-parent":"#filterAccordion"},[e("div",Tr,[(l(!0),c(T,null,L(n.tableData.matchedProperties[i],(m,_)=>(l(),c("label",{class:"border border-primary rounded p-1 d-inline-block me-2 small",for:`cb-filter-current-${i}-${_}`},[e("input",{onChange:g=>o.toggleFilter(i,m),checked:s.filters[i].indexOf(m)>-1,class:"form-check-input",type:"checkbox",value:"",id:`cb-filter-current-${i}-${_}`},null,40,Ir),u(" "+h(m),1)],8,$r))),256)),(l(!0),c(T,null,L(n.suggestionProvider.data[i],(m,_)=>(l(),c(T,null,[n.tableData.matchedProperties[i].indexOf(m[0])===-1?(l(),c("label",{key:0,class:"border border-primary rounded p-1 d-inline-block me-2 small",for:`cb-filter-other-${i}-${_}`},[e("input",{onChange:g=>o.toggleFilter(i,m[0]),checked:s.filters[i].indexOf(m[0])>-1,class:"form-check-input",type:"checkbox",value:"",id:`cb-filter-other-${i}-${_}`},null,40,Fr),u(" "+h(m[0]),1)],8,Lr)):f("",!0)],64))),256))])],8,Dr)])):f("",!0)],64))),256))])]),e("div",Rr,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[0]||(t[0]=b((...i)=>o.clear&&o.clear(...i),["stop","prevent"]))},"Clear all"),e("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=b((...i)=>o.apply&&o.apply(...i),["stop","prevent"]))},"Apply filters")])])])],512)}var Er=v(fr,[["render",Mr]]);const Ur={inject:["util","globalStore","settings"],components:{CloseButton:lt,DownloadDialog:cr,ChevronRight:Yi,ChevronLeft:Bi,DotsVertical:Ei,DeleteLog:at,EditLog:xi,DuplicateLog:_i,FilterDialog:Er},props:{logStore:q,logParser:B,suggestionProvider:K},data(){const r=this.util.dateRange("week",this.util.formatDate(new Date));return{isFiltered:!1,filters:{},dateMode:"week",fromDate:r.lowerUS,toDate:r.upperUS,nextDate:r.next,prevDate:r.prev,tableData:this.logStore.get(r.lower,r.upper,{}),extrasOpen:!1,skipNextToWatch:!1,prefixPropertyMap:{clients:"@",tasks:"#",projects:"%",sources:"/"}}},watch:{fromDate:function(){if(this.dateMode==="week"){let r=new Date(this.fromDate),t=r.getDay();t!==1&&r.setDate(r.getDate()+(t===0?-6:1-t)),this.fromDate=this.util.formatDate(r),this.toDate=this.util.formatDate(r.setDate(r.getDate()+7))}else if(this.dateMode==="month"){let r=new Date(this.fromDate);r.setDate(1),this.fromDate=this.util.formatDate(r),r.setMonth(r.getMonth()+1),r.setHours(-6),this.toDate=this.util.formatDate(r)}}},methods:{changeDateMode(){if(this.dateMode!=="custom"){this.gotoDate(new Date);return}let r=new Date,t;r.setDate(1),t=new Date(r),t.setMonth(t.getMonth()+1),t.setHours(-1),this.fromDate=this.util.formatDate(r),this.toDate=this.util.formatDate(t),this.updateTableData()},setFilters(r){this.filters=r,this.isFiltered=Object.values(r).some(t=>t.length>0),this.updateTableData()},gotoDate(r){const t=this.util.dateRange(this.dateMode,this.util.formatDate(new Date(r)));this.fromDate=t.lowerUS,this.toDate=t.upperUS,this.nextDate=t.next,this.prevDate=t.prev,this.updateTableData()},updateTableData(){this.fromDate===""&&this.toDate!==""&&(this.fromDate=this.toDate),this.fromDate!==""&&this.toDate===""&&(this.toDate=this.fromDate);const r=new Date(this.fromDate),t=new Date(this.toDate);r>t&&(this.toDate=this.fromDate),this.tableData=this.logStore.get(new Date(this.fromDate),new Date(this.toDate),this.filters)},totalCellColspan(){return 1+ +this.settings.showClientColumn+ +this.settings.showProjectColumn+ +this.settings.showTaskColumn+ +this.settings.showSourceColumn},dayTotalTime(r){return r.reduce((t,n)=>t+n.duration,0)},dayTotalCost(r){return r.reduce((t,n)=>t+this.util.costFromRate(n.duration,n.rate),0)},totalTime(){return this.tableData.days.reduce((r,t)=>r+t.total,0)},totalCost(){return this.tableData.days.reduce((r,t)=>r+t.cost,0)},deleteLog(r,t){this.logStore.delete(this.tableData.days[r].logs[t]),this.updateTableData(),this.$emit("hide-suggestions"),this.globalStore.toast("log deleted...")},duplicateLog(r,t){this.logStore.insert(this.logParser.parse(this.tableData.days[r].logs[t].normalized.replace(/^~[a-f0-9 ]*/,""))),this.updateTableData(),this.$emit("hide-suggestions"),this.globalStore.toast("log duplicated...")},editLog(r,t){this.$emit("edit-log",this.tableData.days[r].logs[t])}}},jr={class:"row g-0"},Pr={class:"col-12 mt-3"},Vr={class:"display-6 text-center fw-light"},Or={class:"col-12 d-flex justify-content-between my-3"},Br={key:0,class:"btn-group btn-group-sm h-100 me-1 me-lg-3",role:"group"},Ar={class:"btn-group btn-group-sm max-w-50",role:"group"},Hr=e("option",{value:"week"},"week",-1),zr=e("option",{value:"month"},"month",-1),Nr=e("option",{value:"custom"},"custom",-1),qr=[Hr,zr,Nr],Yr=e("option",{value:"week"},"wk",-1),Kr=e("option",{value:"month"},"mo",-1),Qr=e("option",{value:"custom"},"cu",-1),Jr=[Yr,Kr,Qr],Gr={class:"dropdown"},Wr=e("button",{class:"btn btn-sm btn-secondary dropdown-toggle",type:"button",id:"filters-and-download","data-bs-reference":"parent","data-bs-toggle":"dropdown","aria-expanded":"false"},null,-1),Zr={class:"dropdown-menu","aria-labelledby":"filters-and-download"},Xr={key:0,class:"col-12"},ta={class:"btn-group btn-group-sm mb-2 me-2"},ea=["onClick"],sa={class:"col-12"},na={key:0,class:"alert alert-info my-5"},oa={class:"display-6"},ia={class:"table-responsive"},ra={class:"table table-sm"},aa={key:0},la=e("span",{class:"d-none d-lg-inline"},[u("Client "),e("span",{class:"text-primary"},"@")],-1),da=e("span",{class:"d-inline d-lg-none"},"Clt",-1),ca=[la,da],ua={key:1},ha=e("span",{class:"d-none d-lg-inline"},[u("Project "),e("span",{class:"text-primary"},"%")],-1),pa=e("span",{class:"d-inline d-lg-none"},"Prj",-1),ma=[ha,pa],ga={key:2},fa=u(" Task "),_a=e("span",{class:"d-none d-lg-inline text-primary"},"#",-1),ba=[fa,_a],ya={key:3},wa=e("span",{class:"d-none d-lg-inline"},[u("Source "),e("span",{class:"text-primary"},"/")],-1),va=e("span",{class:"d-inline d-lg-none"},"Src",-1),ka=[wa,va],xa=e("th",null,[e("span",{class:"d-none d-lg-inline"},"Description"),e("span",{class:"d-inline d-lg-none"},"Dsc")],-1),Ca={key:4},Sa=e("th",null,[e("span",{class:"d-none d-lg-inline"},"Duration"),e("span",{class:"d-inline d-lg-none"},"Dur")],-1),Da={key:5},Ta=e("th",null,null,-1),$a=e("th",null,null,-1),Ia={key:0},La={key:1},Fa={key:2},Ra={key:3},Ma={key:4},Ea={key:5,class:"text-end"},Ua=["onClick"],ja={class:"text-end"},Pa=["onClick"],Va={class:"text-end"},Oa=["onClick"],Ba=["colspan"],Aa=["innerHTML"],Ha=["colspan"];function za(r,t,n,a,s,o){const i=w("ChevronLeft"),d=w("ChevronRight"),m=w("DuplicateLog"),_=w("EditLog"),g=w("DeleteLog"),C=w("DownloadDialog"),I=w("FilterDialog");return l(),c("div",null,[e("div",jr,[e("div",Pr,[e("h2",Vr,[u(h(o.util.formatDateRangeByFormat(s.fromDate,s.toDate,o.settings.dateRangeFormat))+" ("+h(o.util.formatDuration(o.totalTime()))+") ",1),o.settings.showCostColumn?(l(),c(T,{key:0},[],64)):f("",!0)])]),e("div",Or,[e("div",null,[s.dateMode!=="custom"?(l(),c("div",Br,[e("button",{type:"button",class:"btn btn-outline-primary btn-icon",onClick:t[0]||(t[0]=y=>this.gotoDate(this.prevDate)),id:"range-prev"},[x(i)]),e("button",{type:"button",class:"btn btn-outline-primary btn-icon",onClick:t[1]||(t[1]=y=>this.gotoDate(this.nextDate)),id:"range-next"},[x(d)])])):f("",!0),e("div",Ar,[p(e("input",{class:"btn btn-outline-primary px-0",type:"date","onUpdate:modelValue":t[2]||(t[2]=y=>s.fromDate=y),onChange:t[3]||(t[3]=(...y)=>o.updateTableData&&o.updateTableData(...y))},null,544),[[k,s.fromDate]]),s.dateMode==="custom"?p((l(),c("input",{key:0,class:"btn btn-outline-primary px-0",type:"date","onUpdate:modelValue":t[4]||(t[4]=y=>s.toDate=y),onChange:t[5]||(t[5]=(...y)=>o.updateTableData&&o.updateTableData(...y))},null,544)),[[k,s.toDate]]):f("",!0)]),p(e("select",{class:"ms-1 ms-lg-3 d-none d-lg-inline-block btn btn-outline-primary btn-sm","onUpdate:modelValue":t[6]||(t[6]=y=>s.dateMode=y),onChange:t[7]||(t[7]=(...y)=>o.changeDateMode&&o.changeDateMode(...y))},qr,544),[[nt,s.dateMode]]),p(e("select",{class:"ms-2 px-0 d-lg-none btn btn-outline-primary btn-sm","onUpdate:modelValue":t[8]||(t[8]=y=>s.dateMode=y),onChange:t[9]||(t[9]=(...y)=>o.changeDateMode&&o.changeDateMode(...y))},Jr,544),[[nt,s.dateMode]])]),e("div",Gr,[Wr,e("ul",Zr,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[10]||(t[10]=b(y=>r.$refs.filterDialog.modal.show(),["stop","prevent"]))},"Filter Data")]),e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[11]||(t[11]=b(y=>r.$refs.downloadDialog.modal.show(),["stop","prevent"]))},"Download")])])])]),s.isFiltered?(l(),c("div",Xr,[e("div",ta,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:t[12]||(t[12]=y=>r.$refs.filterDialog.modal.show())},"Change filters "),e("button",{class:"btn btn-outline-primary btn-sm",onClick:t[13]||(t[13]=y=>r.$refs.filterDialog.clear())},"Clear all")]),(l(!0),c(T,null,L(s.filters,(y,R)=>(l(),c(T,null,[(l(!0),c(T,null,L(y,(M,A)=>(l(),c("button",{type:"button",class:"btn btn-sm btn-outline-info me-2 mb-2",onClick:z=>r.$refs.filterDialog.toggleFilter(R,M,!0)}," \xD7 "+h(s.prefixPropertyMap[R])+h(M),9,ea))),256))],64))),256))])):f("",!0),e("div",sa,[s.tableData.days.length===0?(l(),c("p",na," no data for given date range ")):(l(!0),c(T,{key:1},L(s.tableData.days,(y,R)=>(l(),c("div",null,[e("h3",oa,h(o.util.formatDate(y.date,o.settings.dateFormat)),1),e("div",ia,[e("table",ra,[e("thead",null,[e("tr",null,[o.settings.showClientColumn?(l(),c("th",aa,ca)):f("",!0),o.settings.showProjectColumn?(l(),c("th",ua,ma)):f("",!0),o.settings.showTaskColumn?(l(),c("th",ga,ba)):f("",!0),o.settings.showSourceColumn?(l(),c("th",ya,ka)):f("",!0),xa,o.settings.showCostColumn?(l(),c("th",Ca,"Cost")):f("",!0),Sa,o.settings.showDupeButton?(l(),c("th",Da)):f("",!0),Ta,$a])]),e("tbody",null,[(l(!0),c(T,null,L(y.logs,(M,A)=>(l(),c("tr",null,[o.settings.showClientColumn?(l(),c("td",Ia,h(o.util.join(M.clients,"")),1)):f("",!0),o.settings.showProjectColumn?(l(),c("td",La,h(o.util.join(M.projects,"")),1)):f("",!0),o.settings.showTaskColumn?(l(),c("td",Fa,h(o.util.join(M.tasks,"")),1)):f("",!0),o.settings.showSourceColumn?(l(),c("td",Ra,h(o.util.join(M.sources,"")),1)):f("",!0),e("td",null,h(M.description||"n/a"),1),o.settings.showCostColumn?(l(),c("td",Ma,h(o.util.formatAmount(M.cost,o.settings.currencyFormat)),1)):f("",!0),e("td",null,h(o.util.formatDuration(M.duration)),1),o.settings.showDupeButton?(l(),c("td",Ea,[e("button",{class:"btn btn-link btn-sm btn-icon btn-dupe",onClick:b(z=>o.duplicateLog(R,A),["stop","prevent"])},[x(m)],8,Ua)])):f("",!0),e("td",ja,[e("button",{class:"btn btn-link btn-sm btn-icon btn-dupe",onClick:b(z=>o.editLog(R,A),["stop","prevent"])},[x(_)],8,Pa)]),e("td",Va,[e("a",{class:"btn btn-link btn-sm btn-icon btn-dupe",onClick:b(z=>o.deleteLog(R,A),["stop","prevent"])},[x(g)],8,Oa)])]))),256))]),e("tfoot",null,[e("tr",null,[e("td",{colspan:o.totalCellColspan()},null,8,Ba),o.settings.showCostColumn?(l(),c("td",{key:0,innerHTML:o.util.formatCost(o.dayTotalCost(y.logs),o.settings.currencyFormat,o.settings.tax,o.settings.rateIncludesTax)},null,8,Aa)):f("",!0),e("td",null,h(o.util.formatDuration(o.dayTotalTime(y.logs))),1),e("td",{colspan:o.settings.showDupeButton?3:2},null,8,Ha)])])])])]))),256))])]),x(C,{"table-data":s.tableData,ref:"downloadDialog"},null,8,["table-data"]),x(I,{"table-data":s.tableData,"suggestion-provider":n.suggestionProvider,ref:"filterDialog",onUpdateFilters:o.setFilters},null,8,["table-data","suggestion-provider","onUpdateFilters"])])}var Na=v(Ur,[["render",za]]);const qa={inject:["globalStore"],name:"LoadingModal"},Ya={key:0,class:"position-fixed top-0 start-0 vh-100 vw-100",style:{"z-index":"4096"}},Ka=e("div",{class:"position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-50"},null,-1),Qa=e("div",{class:"position-absolute top-50 start-50 translate-middle px-4 py-2 rounded-3 bg-light shadow"},[e("h1",{class:"fw-light display-1"},"\u{1F4FC}")],-1),Ja=[Ka,Qa];function Ga(r,t,n,a,s,o){return l(),V(xt,{name:"fade"},{default:j(()=>[o.globalStore.loading?(l(),c("div",Ya,Ja)):f("",!0)]),_:1})}var Wa=v(qa,[["render",Ga]]);const Za={},Xa={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},tl=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 6h16M4 12h16M4 18h16"},null,-1),el=[tl];function sl(r,t){return l(),c("svg",Xa,el)}var nl=v(Za,[["render",sl]]);const ol={components:{MenuToggle:nl}},il={class:"container"},rl={class:"row"},al={class:"col-12 d-flex justify-content-between"},ll=e("h1",{class:"fw-lighter"},[e("kbd",null,"TMLG")],-1),dl={href:"#",class:"h-100 d-block show-menu btn btn-icon","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasControls","aria-controls":"offcanvasControls"};function cl(r,t,n,a,s,o){const i=w("MenuToggle");return l(),c("div",il,[e("div",rl,[e("div",al,[ll,e("a",dl,[x(i)])])])])}var ul=v(ol,[["render",cl]]);const hl={name:"ImportExportDialog",inject:["settings","util"],props:{timelogStore:q,sync:H,suggestionProvider:K},data(){return{importData:!1,importView:"select",view:"import",modal:null,exports:{settings:!0,syncCredentials:this.sync.hasCredentials,data:!0},imports:{settings:!0,syncCredentials:!0,data:!0}}},mounted(){this.modal=new O(this.$refs.modal),this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.view="import",this.importView="select",this.importData=null}),this.$refs.fileInput.addEventListener("change",this.handleFileChange.bind(this),!1)},methods:{show(){this.modal.show()},handleFileChange(r){const t=r.target.files[0];t&&fetch(window.URL.createObjectURL(t)).then(n=>n.json()).then(n=>{if(!("includes"in n&&("settings"in n||"data"in n||"syncCredentials"in n)))return this.importView="error";this.importData=n,this.importView="confirm"}).catch(()=>{this.importView="error"})},download(){let r={includes:[]};if(this.exports.settings){const n=JSON.parse(JSON.stringify(U({},this.settings.$state)));r.includes.push("Settings"),r.settings=n}this.exports.data&&(r.includes.push("Data"),r.data=JSON.parse(JSON.stringify(this.timelogStore.data)),r.transactions=JSON.parse(JSON.stringify(this.timelogStore.transactions))),this.exports.syncCredentials&&(r.includes.push("syncCredentials"),r.syncCredentials=JSON.parse(JSON.stringify(this.sync.getCredentials())));let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(r))),t.setAttribute("download",`Timelog Export (${r.includes.join(", ")}).json`),document.body.appendChild(t),t.click(),document.body.removeChild(t)},importFromData(){let r=new Y;this.imports.data&&(r.set("data",this.importData.data),r.set("transactions",this.importData.transactions),r.remove("suggestions")),this.imports.settings&&r.set("settings",this.importData.settings),this.imports.syncCredentials&&(r.set("credentials",this.importData.syncCredentials),r.remove("lastUpdated")),window.location.reload()}}},pl={class:"modal fade",ref:"modal",id:"importExportModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"importExportModalLabel","aria-hidden":"true"},ml={class:"modal-dialog modal-lg modal-dialog-scrollable modal-fullscreen-md-down"},gl={class:"modal-content"},fl=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"importExportModalLabel"},"Import/Export"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),_l={class:"modal-body"},bl={class:"nav nav-tabs",id:"importExportTabs",role:"tablist"},yl={class:"nav-item",role:"presentation"},wl=["aria-selected"],vl={class:"nav-item",role:"presentation"},kl=["aria-selected"],xl={class:"tab-content mt-3",id:"importExportTabsContent"},Cl={key:0},Sl=e("label",{for:"importFile",class:"form-label"},"File to import",-1),Dl={ref:"fileInput",class:"form-control form-control-lg",id:"importFile",type:"file",accept:".json"},Tl={key:1,class:"alert alert-danger"},$l=u(" The given file was malformed or does not contain data that can be imported. "),Il={key:2},Ll={class:"form-check form-switch mb-2"},Fl=["disabled"],Rl=e("label",{class:"form-check-label",for:"import-data"},[u(" Import "),e("code",null,"data"),u(" from given file ")],-1),Ml={class:"form-check form-switch mb-2"},El=["disabled"],Ul=e("label",{class:"form-check-label",for:"import-settings"},[u(" Import "),e("code",null,"settings"),u(" from given file ")],-1),jl={class:"form-check form-switch mb-2"},Pl=["disabled"],Vl=e("label",{class:"form-check-label",for:"import-synccredentials"},[u(" Import "),e("code",null,"sync credentials"),u(" from given file ")],-1),Ol=e("div",{class:"alert alert-warning"}," Existing data will be wiped! ",-1),Bl={class:"form-check form-switch mb-2"},Al=e("label",{class:"form-check-label",for:"export-data"},[u(" Include "),e("code",null,"data"),u(" in the export. "),e("br"),u(),e("small",null,"Sync Transactions are included as well if they exist.")],-1),Hl={class:"form-check form-switch mb-2"},zl=e("label",{class:"form-check-label",for:"export-settings"},[u(" Include "),e("code",null,"settings"),u(" in the export. "),e("br"),u(),e("small",null,"Exporting the settings will restore all your settings when you import.")],-1),Nl={class:"form-check form-switch mb-2"},ql=["disabled"],Yl=e("label",{class:"form-check-label",for:"export-synccredentials"},[u(" Include "),e("code",null,"sync credentials"),u(" in the export. "),e("br"),e("small",null,"Exporting the settings will restore all your settings when you import.")],-1),Kl={key:0,class:"alert alert-warning"},Ql=u(" Your password will be stored as "),Jl=e("u",null,"plain text",-1),Gl=u(" in the export file! "),Wl=[Ql,Jl,Gl],Zl={class:"modal-footer d-flex justify-content-center"};function Xl(r,t,n,a,s,o){return l(),c("div",pl,[e("div",ml,[e("div",gl,[fl,e("div",_l,[e("ul",bl,[e("li",yl,[e("button",{class:D(["nav-link",{active:s.view==="import"}]),id:"import-tab","data-bs-toggle":"tab","data-bs-target":"#import",type:"button",role:"tab","aria-controls":"import","aria-selected":s.view==="import",onClick:t[0]||(t[0]=i=>s.view="import")},"Import ",10,wl)]),e("li",vl,[e("button",{class:D(["nav-link",{active:s.view==="export"}]),id:"export-tab","data-bs-toggle":"tab","data-bs-target":"#export",type:"button",role:"tab","aria-controls":"export","aria-selected":s.view==="export",onClick:t[1]||(t[1]=i=>s.view="export")},"Export ",10,kl)])]),e("div",xl,[e("div",{class:D(["tab-pane fade",{active:s.view==="import",show:s.view==="import"}]),id:"import",role:"tabpanel","aria-labelledby":"import-tab"},[s.importView==="select"?(l(),c("div",Cl,[Sl,e("input",Dl,null,512)])):s.importView==="error"?(l(),c("div",Tl,[$l,e("a",{href:"#",onClick:t[2]||(t[2]=b(i=>s.importView="select",["stop","prevent"]))},"Try again")])):s.importView==="confirm"?(l(),c("div",Il,[e("div",Ll,[p(e("input",{disabled:s.importData&&!("data"in s.importData),class:"form-check-input",type:"checkbox",id:"import-data","onUpdate:modelValue":t[3]||(t[3]=i=>s.imports.data=i)},null,8,Fl),[[$,s.imports.data]]),Rl]),e("div",Ml,[p(e("input",{disabled:s.importData&&!("settings"in s.importData),class:"form-check-input",type:"checkbox",id:"import-settings","onUpdate:modelValue":t[4]||(t[4]=i=>s.imports.settings=i)},null,8,El),[[$,s.imports.settings]]),Ul]),e("div",jl,[p(e("input",{disabled:s.importData&&!("syncCredentials"in s.importData),class:"form-check-input",type:"checkbox",id:"import-synccredentials","onUpdate:modelValue":t[5]||(t[5]=i=>s.imports.syncCredentials=i)},null,8,Pl),[[$,s.imports.syncCredentials]]),Vl]),Ol])):f("",!0)],2),e("div",{class:D(["tab-pane fade",{active:s.view==="export",show:s.view==="export"}]),id:"export",role:"tabpanel","aria-labelledby":"export-tab"},[e("div",Bl,[p(e("input",{class:"form-check-input",type:"checkbox",id:"export-data","onUpdate:modelValue":t[6]||(t[6]=i=>s.exports.data=i)},null,512),[[$,s.exports.data]]),Al]),e("div",Hl,[p(e("input",{class:"form-check-input",type:"checkbox",id:"export-settings","onUpdate:modelValue":t[7]||(t[7]=i=>s.exports.settings=i)},null,512),[[$,s.exports.settings]]),zl]),e("div",Nl,[p(e("input",{disabled:!n.sync.hasCredentials,class:"form-check-input",type:"checkbox",id:"export-synccredentials","onUpdate:modelValue":t[8]||(t[8]=i=>s.exports.syncCredentials=i)},null,8,ql),[[$,s.exports.syncCredentials]]),Yl]),n.sync.hasCredentials&&s.exports.syncCredentials?(l(),c("div",Kl,Wl)):f("",!0)],2)])]),e("div",Zl,[s.view==="export"&&(s.exports.syncCredentials||s.exports.data||s.exports.settings)?(l(),c("button",{key:0,class:"btn btn-outline-primary",onClick:t[9]||(t[9]=(...i)=>o.download&&o.download(...i))},"Download ")):f("",!0),s.importView==="confirm"&&s.view==="import"&&(s.imports.syncCredentials||s.imports.data||s.imports.settings)?(l(),c("button",{key:1,class:"btn btn-outline-primary",onClick:t[10]||(t[10]=(...i)=>o.importFromData&&o.importFromData(...i))},"Import now ")):f("",!0)])])])],512)}var td=v(hl,[["render",Xl]]);const ed={inject:["util","globalStore","settings"],name:"ImportSyncCredentialsFromURLDialog",props:{sync:H},data(){return{modal:!1,encryptedSyncCredentials:null,syncId:null,server:"",passwordType:"password",password:"",encryptedSyncCredentialsError:!1,decryptedSyncCredentials:null,urlIncludesPassword:!1}},mounted(){this.modal=new O(this.$refs.modal)},methods:{show(){this.encryptedSyncCredentials=new URL(window.location).searchParams.get("encryptedSyncCredentials"),new URL(window.location).searchParams.has("password")&&(this.urlIncludesPassword=!0,this.password=atob(new URL(window.location).searchParams.get("password")),this.passwordType="text");const r=new URL(window.location);r.searchParams.delete("encryptedSyncCredentials"),r.searchParams.delete("password"),window.history.replaceState({},document.title,r.toString()),this.modal.show()},decryptEncryptedPassword(){this.sync.decryptData(this.encryptedSyncCredentials,this.password).then(r=>{try{const t=JSON.parse(r);this.sync.setCredentials(t.server,t.syncId,this.password),this.sync.storeCredentials(),this.globalStore.toast("Sync","Credentials successfully imported!"),this.modal.hide()}catch{this.encryptedSyncCredentialsError=!0}})}}},sd={class:"modal fade",ref:"modal",id:"importSyncCredentials","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"importSyncCredentialsLabel","aria-hidden":"true"},nd={class:"modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"},od={class:"modal-content"},id=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"importSyncCredentialsLabel"}," Import Sync Credentials "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),rd={class:"modal-body"},ad={class:"row"},ld={class:"col-12"},dd={key:0,class:"alert alert-warning"},cd={class:"mb-3"},ud=e("label",{for:"password",class:"form-label"},"To import the encrypted syncId, please enter the encryption password you used for that syncId:",-1),hd={class:"input-group"},pd=["type"],md={key:1,class:"alert alert-danger"},gd={class:"d-flex justify-content-center"},fd=["disabled"];function _d(r,t,n,a,s,o){return l(),c("div",sd,[e("div",nd,[e("div",od,[id,e("div",rd,[e("div",ad,[e("div",ld,[n.sync.hasCredentials?(l(),c("p",dd," Warning, this browser already has a syncId stored. Proceeding will disconnect from the currently used synchronization and may cause data loss! ")):f("",!0),e("div",cd,[ud,e("div",hd,[p(e("input",{class:"form-control",type:s.passwordType,autocomplete:"current-password",id:"password","onUpdate:modelValue":t[0]||(t[0]=i=>s.password=i)},null,8,pd),[[G,s.password]]),e("button",{class:"btn-outline-secondary btn",id:"passwordAddon",onClick:t[1]||(t[1]=i=>s.passwordType=s.passwordType==="password"?"text":"password")},h(s.passwordType==="password"?"show":"hide"),1)])]),s.encryptedSyncCredentialsError?(l(),c("p",md," The provided password failed to decrypt the syncId :( ")):f("",!0),e("div",gd,[e("button",{type:"button",class:"btn btn-outline-primary",disabled:!s.password,onClick:t[2]||(t[2]=(...i)=>o.decryptEncryptedPassword&&o.decryptEncryptedPassword(...i))}," Import syncId ",8,fd)])])])])])])],512)}var bd=v(ed,[["render",_d]]);const yd={name:"TabContent",props:{name:String,view:String}},wd=["id"],vd=["id","aria-labelledby"];function kd(r,t,n,a,s,o){return l(),c("div",{class:"tab-content mt-3",id:`${n.name}TabsContent`},[e("div",{class:D(["tab-pane fade",{active:n.view===n.name,show:n.view===n.name}]),id:`${n.name}TabsPane`,role:"tabpanel","aria-labelledby":`${n.name}-tab`},[ot(r.$slots,"default")],10,vd)],8,wd)}var W=v(yd,[["render",kd]]);const xd={inject:["util"],name:"SyntaxContent",components:{TabContent:W},props:{parser:B,view:String},data(){return{dateExample:this.parser.dateTimeHelper.formatDate(new Date,this.parser.options.dateFormat).slice(0,-5)}}},Cd=e("h3",{class:"fw-light"},"Timelog Syntax",-1),Sd=e("p",null,"Timelog properties are attached by using certain prefix characters. Properties will be suggested ordered by how often they are used. ",-1),Dd=e("p",null,[u("On a device with physical keyboard, use "),e("kbd",null,"up"),u(" and "),e("kbd",null,"down"),u(" to navigate the suggestions, "),e("kbd",null,"enter"),u(" or "),e("kbd",null,"tab"),u(" to insert the highlighted suggestion.")],-1),Td=e("h3",null,[e("code",null,[e("kbd",null,"@"),u("client")])],-1),$d=e("p",null,[u("Use the "),e("code",null,"@"),u(" symbol to add one or more clients to a timelog. Clients will be suggested based on past timelogs. You can toggle the "),e("code",null,"client"),u("-column in the settings and set a default client to be used when no client is given.")],-1),Id=e("h3",null,[e("code",null,[e("kbd",null,"%"),u("project")])],-1),Ld=e("p",null,[u("Use the "),e("code",null,"%"),u(" symbol to add one or more projects to a timelog. Projects will be suggested based on past timelogs. You can toggle the "),e("code",null,"project"),u("-column in the settings and set a default project to be used when no project is given.")],-1),Fd=e("h3",null,[e("code",null,[e("kbd",null,"#"),u("task")])],-1),Rd=e("p",null,[u("Use the "),e("code",null,"#"),u(" symbol to add one or more tasks to a timelog. Tasks will be suggested based on past timelogs. You can toggle the "),e("code",null,"tasks"),u("-column in the settings and set a default task to be used when no task is given.")],-1),Md=e("h3",null,[e("code",null,[e("kbd",null,"/"),u("source")])],-1),Ed=e("p",null,[u("Use the "),e("code",null,"/"),u(" symbol to add one or more sources to a timelog. Sources will be suggested based on past timelogs. You can toggle the "),e("code",null,"sources"),u("-column in the settings and set a default source to be used when no source is given.")],-1),Ud=e("h3",null,[e("code",null,[e("kbd",null,"+"),u("1:30")]),u(" (duration)")],-1),jd=e("p",null,[u("Use the "),e("code",null,"+"),u(" symbol to add a duration to the timelog. When omitted, the default duration setting will be used. When you give a single digit value below the "),e("code",null,"hourThreshold"),u(" setting, the input will be converted to hours. You can toggle the "),e("code",null,"duration"),u("-column in the settings.")],-1),Pd=e("kbd",null,":",-1),Vd=u(" (date)"),Od=e("p",null,[u("Use the "),e("code",null,":"),u(" symbol to add a date to the timelog. When omitted, the current date setting will be used. There are several shortcuts like "),e("code",null,":-2"),u(", "),e("code",null,":lasttue"),u(". ")],-1),Bd=e("h3",null,[e("code",null,[e("kbd",null,"$"),u("1234")]),u(" (rate)")],-1),Ad=e("p",null,[u("Use the "),e("code",null,"$"),u(" symbol to add a custom rate to the timelog. When omitted, the default rate setting will be used. You can toggle the "),e("code",null,"cost"),u("-column in the settings.")],-1),Hd=e("h3",{class:"fw-light"},"Everything else",-1),zd=e("p",null,"Everything that isn't matched as as property is considered as description and will be used as such.",-1),Nd=e("h3",{class:"fw-light"},"Multiple Logs",-1),qd=e("p",null,[u("User "),e("kbd",null,"----"),u(" (4x dash) to separate multiple logs. On store, each timelog will be created individually.")],-1),Yd=e("h3",{class:"fw-light"},[u("Timers"),e("kbd",null,"&")],-1),Kd=e("p",null,[u(" Add an "),e("code",null,"&"),u(" at the end of a timelog to create timer instead of storing the timelog instantly. "),e("br"),u(" Timers are not synced! ")],-1);function Qd(r,t,n,a,s,o){const i=w("TabContent");return l(),V(i,{name:"help",view:n.view},{default:j(()=>[Cd,Sd,Dd,Td,$d,Id,Ld,Fd,Rd,Md,Ed,Ud,jd,e("h3",null,[e("code",null,[Pd,u(h(s.dateExample),1)]),Vd]),Od,e("p",null,[e("a",{href:"#",onClick:t[0]||(t[0]=b(d=>r.$emit("set-view","dateparse"),["stop","prevent"]))},"More on Date and Duration")]),Bd,Ad,Hd,zd,e("p",null,[e("a",{href:"#",onClick:t[1]||(t[1]=b(d=>r.$emit("set-view","parsetest"),["stop","prevent"]))},"Explore parser behaviour")]),Nd,qd,Yd,Kd]),_:1},8,["view"])}var Jd=v(xd,[["render",Qd]]);const Gd={name:"TabButton",props:{name:String,view:String}},Wd={class:"nav-item",role:"presentation"},Zd=["id","aria-controls","aria-selected"];function Xd(r,t,n,a,s,o){return l(),c("li",Wd,[e("button",{class:D(["nav-link",{active:n.view===n.name}]),id:`${n.name}-tab`,type:"button",role:"tab","aria-controls":`${n.name}TabsPane`,"aria-selected":n.view===n.name,onClick:t[0]||(t[0]=i=>r.$emit("set-view",n.name))},[ot(r.$slots,"default")],10,Zd)])}var tc=v(Gd,[["render",Xd]]);const ec={name:"SyncContent",components:{TabContent:W},props:{view:String}},sc=e("h3",{class:"fw-light"},"Synchronization",-1),nc=e("p",null," Synchronization enables time tracking across multiple devices/platforms and provides a good way to have a backup of your timelogs in the cloud. ",-1),oc=e("p",null," Data is stored with strong encryption (AES-GCM) and no server side data processing whatsoever. The synchronization of your data across devices is handled by each device independently, so differences in the order of timelogs within a day might occur. ",-1),ic=e("p",null,[u(" Online storage currently piggybacks off "),e("a",{href:"https://www.xbrowsersync.org/",target:"_blank",rel:"noopener"},"xBrowserSync's"),u(" API servers but you can create your own instance using their "),e("a",{href:"https://github.com/xbrowsersync/api",target:"_blank",rel:"noopener"},"API code"),u(". ")],-1),rc=e("p",null,[u(" Please make sure you use a good and "),e("u",null,"unique"),u(" password, since there is no way to recover the password in case you lose it. The password will be stored in "),e("u",null,"plain text"),u(" in your browser's local storage which is accessible by anyone who has access to your device, so make that you do NOT use it for any other service. ")],-1),ac=e("p",null," Synchronization relies on built-in features of the browser (Cryptography, Compression) that may not be available in certain engines or older versions. Some Chromium-based browser with a current build number is recommended! ",-1);function lc(r,t,n,a,s,o){const i=w("TabContent");return l(),V(i,{name:"synchronization",view:n.view},{default:j(()=>[sc,nc,oc,ic,rc,ac]),_:1},8,["view"])}var dc=v(ec,[["render",lc]]);const cc={name:"DateparseContent",components:{TabContent:W},inject:["util"],props:{view:String,parser:B},data(){return{dd:this.parser.options.defaultDuration,ht:this.parser.options.hourThreshold,durations:["","+1.06","+1:05","+1:50","+0:30","+0.5","+10","+2","+2.5","+2:30","+10","+.5","+45"],dates:["",":t",":today",":y",":yesterday",":-1",":-3",":+1",":+2",":mon",":fri",":lastwed",":nexttue",":"+this.parser.dateTimeHelper.convertFormattedString("22.01","dd.mm.yyyy",this.parser.options.dateFormat).slice(0,-5),":"+this.parser.dateTimeHelper.convertFormattedString("11.12","dd.mm.yyyy",this.parser.options.dateFormat).slice(0,-5),":"+this.parser.dateTimeHelper.convertFormattedString("10.03.2021","dd.mm.yyyy",this.parser.options.dateFormat)]}}},uc=e("h3",{class:"fw-light"},"Dates",-1),hc=u("Dates are parsed from the configured date format ("),pc=u(") and several shortcuts:"),mc={class:"table duration-examples"},gc=e("thead",null,[e("tr",null,[e("th",null,"value"),e("th",null,"parsed date")])],-1),fc=e("h3",{class:"fw-light"},"Durations",-1),_c=e("p",null,[u("Durations are parsed to minutes and displayed in "),e("code",null,"hh:mm"),u(" format:")],-1),bc={class:"table duration-examples"},yc=e("thead",null,[e("tr",null,[e("th",null,"value"),e("th",null,"parsed minutes"),e("th",null,"hh:mm")])],-1);function wc(r,t,n,a,s,o){const i=w("TabContent");return l(),V(i,{name:"dateparse",view:n.view},{default:j(()=>[uc,e("p",null,[hc,e("code",null,h(n.parser.options.dateFormat),1),pc]),e("table",mc,[gc,e("tbody",null,[(l(!0),c(T,null,L(s.dates,(d,m)=>(l(),c("tr",null,[e("td",null,[e("code",null,h(d)+" "+h(d===""?"(empty)":""),1)]),e("td",null,h(o.util.formatDate(n.parser.dateTimeHelper.parseDate(d,n.parser.options.dateFormat),n.parser.options.dateFormat)),1)]))),256))])]),fc,_c,e("table",bc,[yc,e("tbody",null,[(l(!0),c(T,null,L(s.durations,(d,m)=>(l(),c("tr",null,[e("td",null,[e("code",null,h(d)+" "+h(d===""?"(empty)":""),1)]),e("td",null,h(n.parser.dateTimeHelper.parseDuration(d,s.dd,s.ht)),1),e("td",null,h(o.util.formatDuration(n.parser.dateTimeHelper.parseDuration(d,s.dd,s.ht))),1)]))),256))])])]),_:1},8,["view"])}var vc=v(cc,[["render",wc]]);const kc={name:"ParsetestContent",components:{TabContent:W},inject:["util"],props:{view:String,parser:B},data(){return{options:this.parser.options,logString:"",parsed:this.parser.decoratedParse(""),examples:{empty:"",full:"@acme %relaunch #support /jira:ACRL-1842 +93 :-2 $99 summarize how aspect ratio works",sparse:"@acme #support /phone determine how many edges a rectangle has",multi:"@acme @designcompany #concept #planning %relaunch %refactoring :-2 +3 discuss framework upgrade"}}},watch:{logString:function(){this.parsed=this.parser.decoratedParse(this.logString)}}},xc=e("h3",{class:"fw-light"},"Parse Test",-1),Cc={class:"small"},Sc=u(" Examples: "),Dc=["onClick"],Tc={class:"table"},$c=e("thead",null,[e("tr",null,[e("th",null," property "),e("th",null," matched "),e("th",null," is default ")])],-1),Ic=e("td",null,[e("code",null,"@client")],-1),Lc=e("td",null,[e("code",null,"%project")],-1),Fc=e("td",null,[e("code",null,"#task")],-1),Rc=e("td",null,[e("code",null,"/source")],-1),Mc=e("td",null,[e("code",null,"+duration")],-1),Ec=e("td",null,[e("code",null,":date")],-1),Uc=e("td",null,[e("code",null,"$rate")],-1),jc=e("td",null,[e("code",null,"(cost)")],-1),Pc=e("td",null," n/a ",-1),Vc=e("td",null,[e("code",null,"description")],-1),Oc=e("td",null," n/a ",-1),Bc=e("td",null,[e("code",null,"normalized")],-1),Ac={colspan:"2"},Hc=e("td",null,[e("code",null,"is timer")],-1),zc={colspan:"2"};function Nc(r,t,n,a,s,o){const i=w("TabContent");return l(),V(i,{name:"parsetest",view:n.view},{default:j(()=>[xc,p(e("textarea",{ref:"ta",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=d=>s.logString=d)},null,512),[[k,s.logString]]),e("div",Cc,[Sc,(l(!0),c(T,null,L(s.examples,(d,m)=>(l(),c("a",{href:"#",class:"me-1",onClick:b(_=>s.logString=d,["stop","prevent"])},h(m),9,Dc))),256))]),e("table",Tc,[$c,e("tbody",null,[e("tr",null,[Ic,e("td",null,h(o.util.join(s.parsed.clients,"")),1),e("td",null,h(s.parsed.usesDefaultClient?"yes":"no"),1)]),e("tr",null,[Lc,e("td",null,h(o.util.join(s.parsed.projects,"")),1),e("td",null,h(s.parsed.usesDefaultProject?"yes":"no"),1)]),e("tr",null,[Fc,e("td",null,h(o.util.join(s.parsed.tasks,"")),1),e("td",null,h(s.parsed.usesDefaultTask?"yes":"no"),1)]),e("tr",null,[Rc,e("td",null,h(o.util.join(s.parsed.sources,"")),1),e("td",null,h(s.parsed.usesDefaultSource?"yes":"no"),1)]),e("tr",null,[Mc,e("td",null,h(o.util.formatDuration(s.parsed.duration)),1),e("td",null,h(s.parsed.usesDefaultDuration?"yes":"no"),1)]),e("tr",null,[Ec,e("td",null,h(o.util.formatDate(s.parsed.timestamp,s.options.dateFormat)),1),e("td",null,h(s.parsed.usesDefaultDate?"yes":"no"),1)]),e("tr",null,[Uc,e("td",null,h(o.util.formatCost(s.parsed.rate,s.options.currencyFormat)),1),e("td",null,h(s.parsed.usesDefaultRate?"yes":"no"),1)]),e("tr",null,[jc,e("td",null,h(o.util.formatCost(o.util.costFromRate(s.parsed.duration,s.parsed.rate),s.options.currencyFormat)),1),Pc]),e("tr",null,[Vc,e("td",null,h(s.parsed.description),1),Oc]),e("tr",null,[Bc,e("td",Ac,[e("code",null,h(s.parsed.normalized),1)])]),e("tr",null,[Hc,e("td",zc,[e("code",null,h(s.parsed.isTimer?"yes":"no"),1)])])])])]),_:1},8,["view"])}var qc=v(kc,[["render",Nc]]);const Yc={name:"HelpDialog",components:{ParsetestContent:qc,DateparseContent:vc,SyncContent:dc,TabButton:tc,SyntaxContent:Jd},props:{parser:B},data(){return{modal:null,view:"help"}},mounted(){this.modal=new O(this.$refs.modal)},methods:{show(r="help"){this.view=r,this.modal.show()},setView(r){this.view=r}}},Kc={class:"modal fade",ref:"modal",id:"helpHowTo","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"helpHowToLabel","aria-hidden":"true"},Qc={class:"modal-dialog modal-lg modal-dialog-scrollable modal-fullscreen-md-down"},Jc={class:"modal-content"},Gc=e("div",{class:"modal-header"},[e("h5",{class:"modal-title fw-light",id:"helpHowToLabel"},"Help & Howto "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Wc={class:"modal-body"},Zc={class:"nav nav-tabs",id:"helpTabs",role:"tablist"},Xc=u("Syntax"),tu=u("Date and Duration"),eu=u("Synchronization"),su=u("Parse Test");function nu(r,t,n,a,s,o){const i=w("TabButton"),d=w("SyntaxContent"),m=w("DateparseContent"),_=w("SyncContent"),g=w("ParsetestContent");return l(),c("div",Kc,[e("div",Qc,[e("div",Jc,[Gc,e("div",Wc,[e("ul",Zc,[x(i,{name:"help",view:s.view,onSetView:o.setView},{default:j(()=>[Xc]),_:1},8,["view","onSetView"]),x(i,{name:"dateparse",view:s.view,onSetView:o.setView},{default:j(()=>[tu]),_:1},8,["view","onSetView"]),x(i,{name:"synchronization",view:s.view,onSetView:o.setView},{default:j(()=>[eu]),_:1},8,["view","onSetView"]),x(i,{name:"parsetest",view:s.view,onSetView:o.setView},{default:j(()=>[su]),_:1},8,["view","onSetView"])]),x(d,{view:s.view,onSetView:o.setView,parser:n.parser},null,8,["view","onSetView","parser"]),x(m,{view:s.view,parser:n.parser},null,8,["view","parser"]),x(_,{view:s.view},null,8,["view"]),x(g,{view:s.view,parser:n.parser},null,8,["view","parser"])])])])],512)}var ou=v(Yc,[["render",nu]]);const iu={},ru={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},au=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),lu=[au];function du(r,t){return l(),c("svg",ru,lu)}var cu=v(iu,[["render",du]]);const uu={},hu={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},pu=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},null,-1),mu=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),gu=[pu,mu];function fu(r,t){return l(),c("svg",hu,gu)}var _u=v(uu,[["render",fu]]);const bu={},yu={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},wu=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1),vu=[wu];function ku(r,t){return l(),c("svg",yu,vu)}var xu=v(bu,[["render",ku]]);const Cu={emits:["end-timer"],components:{DeleteLog:at,CheckMark:xu,PlayButton:_u,PauseButton:cu},inject:["util","settings"],props:{timers:tt,logParser:B},data(){return{refreshKey:0,timeout:null}},watch:{timers:{deep:!0,handler:function(){this.timeout===null&&this.increaseKey()}}},mounted(){this.timeout=setTimeout(this.increaseKey,6e4)},methods:{increaseKey(){this.refreshKey++,this.timers.timers.length>0?this.timeout=setTimeout(this.increaseKey,6e4):this.timeout=null}}},Su={class:"me-1"},Du={key:0,class:"me-1"},Tu={key:1,class:"me-1"},$u={key:2,class:"me-1"},Iu={key:3,class:"me-1"},Lu={key:4,class:"me-1"},Fu={key:5,class:"me-1"},Ru=["onClick"],Mu=["onClick"],Eu=["onClick"];function Uu(r,t,n,a,s,o){const i=w("PauseButton"),d=w("PlayButton"),m=w("CheckMark"),_=w("DeleteLog");return l(),c("div",{key:s.refreshKey},[(l(!0),c(T,null,L(n.timers.timers,(g,C)=>(l(),c("div",{class:D(["alert mt-3 p-2 d-flex justify-content-between",{"alert-info":g.state==="running","alert-warning":g.state!=="running"}])},[e("div",null,[e("strong",Su,h(o.util.formatDuration(g.state==="running"?n.timers.duration(g.started)+g.minutes:g.minutes)),1),g.timelog.clients.length>0?(l(),c("span",Du,h(o.util.join(g.timelog.clients,"@")),1)):f("",!0),g.timelog.projects.length>0?(l(),c("span",Tu,h(o.util.join(g.timelog.projects,"%")),1)):f("",!0),g.timelog.tasks.length>0?(l(),c("span",$u,h(o.util.join(g.timelog.tasks,"#")),1)):f("",!0),g.timelog.sources.length>0?(l(),c("span",Iu,h(o.util.join(g.timelog.sources,"/")),1)):f("",!0),g.timelog.description.length>0?(l(),c("span",Lu,h(g.timelog.description),1)):f("",!0),o.settings.showCostColumn?(l(),c("strong",Fu,h(o.util.formatAmount(o.util.costFromRate(n.timers.duration(g.started)+g.minutes,g.timelog.rate),o.settings.currencyFormat)),1)):f("",!0)]),e("div",{class:D(["btn-group",{pulse:g.state==="running"}]),role:"group"},[e("button",{class:D(["btn py-1 btn-icon",{"btn-outline-info":g.state==="running","btn-outline-warning":g.state!=="running"}]),onClick:b(I=>n.timers.toggle(C),["stop","prevent"])},[g.state==="running"?(l(),V(i,{key:0})):(l(),V(d,{key:1}))],10,Ru),e("button",{class:D(["btn py-1 btn-icon",{"btn-outline-info":g.state==="running","btn-outline-warning":g.state!=="running"}]),onClick:b(I=>r.$emit("end-timer",n.timers.end(C)),["stop","prevent"])},[x(m)],10,Mu),e("button",{class:D(["btn py-1 btn-icon",{"btn-outline-info":g.state==="running","btn-outline-warning":g.state!=="running"}]),onClick:b(I=>n.timers.delete(C),["stop","prevent"])},[x(_)],10,Eu)],2)],2))),256))])}var ju=v(Cu,[["render",Uu]]);const Pu={filenameTemplate:"Timelogs %s",dateFormat:"dd.mm.yyyy",dateRangeFormat:"dd.mm?.yyyy? - dd.mm.yyyy",closeFiltersOnApply:!0,checkForUpdateIntervalMinutes:10,storeOnControlEnter:!0,clearTimeLogOnStore:!0,showParsePreviewOnType:!0,keepOriginalLogOnEdit:!1,defaultDuration:30,hourThreshold:5,defaultRate:255,currencyFormat:"%s \u20AC",rateIncludesTax:!0,tax:0,showCostColumn:!0,showProjectColumn:!0,showSourceColumn:!0,showClientColumn:!0,showTaskColumn:!0,showDupeButton:!0,defaultClient:"",defaultProject:"",defaultTask:"",defaultSource:"",deviceName:null,deviceId:null,syncEnabled:!0,syncSettings:!0,defaultView:"month",showHelpIcon:!0};class dt{constructor(){S(this,"dateTimeHelper");this.dateTimeHelper=new rt}defaultDates(){const t=new Date(2022,11,29).toLocaleDateString().replace("2022","yyyy").replace("22","yy").replace("12","mm").replace("29","dd"),n=t.replace("yyyy","yyyy?").replace("mm","mm?")+" - "+t;return{defaultDateFormat:t,defaultDateRangeFormat:n}}join(t,n="",a="n/a"){return t.length===0?a:(n+t.join(", "+n)).trim()}copyToClipboard(t,n){const a=document.createElement("textarea");a.classList.add("position-absolute","opacity-0","start-0","top-0"),n.insertAdjacentElement("afterend",a),a.value=t,a.focus(),a.select(),document.execCommand("copy"),a.blur(),a.remove()}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}round(t,n=2){return Math.round(t*Math.pow(10,n))/Math.pow(10,n)}formatDateRangeByFormat(t,n,a){return this.dateTimeHelper.formatRange(t,n,a)}formatDate(t,n="yyyy-mm-dd"){return this.dateTimeHelper.formatDate(t,n)}floatHoursFromMinutes(t){const n=Math.floor(t/60),a=(t-n*60)/60;return n+a}formatDuration(t){const n=Math.floor(t/60),a=t-n*60;return`${n}:${("0"+a).slice(-2)}`}costFromRate(t,n){return this.floatHoursFromMinutes(t)*n}formatAmount(t,n){const a=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(t).replace(/\s.*$/,"").replace(/[^\d.',-]/g,"");return n.replace("%s",a)}formatCost(t,n,a=0,s=!1){if(a===0)return this.formatAmount(this.round(t),n);let o;const i=a*.01;s?o=t-t/(1+i):(o=t*i,t+=o);const d=this.formatAmount(this.round(t),n),m=this.formatAmount(this.round(o),n);return`${d} <small>(incl ${m} tax)</small>`}formatBytes(t,n=2){if(t===0)return"0 Bytes";const a=1024,s=n<0?0:n,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,i)).toFixed(s))+" "+o[i]}hash(t){return globalThis.crypto&&"getRandomValues"in globalThis.crypto?Array.from(globalThis.crypto.getRandomValues(new Uint8Array(t))).map(n=>("0"+n.toString(16)).slice(-2)).join(""):require("crypto").randomBytes(t).toString("hex")}dateRange(t,n){let[a,s,o]=n.split("-").map(C=>parseInt(C)),i=new Date(a,s-1,o);i.setMilliseconds(0);let d,m=new Date(i),_=new Date(i),g=new Date(i);return t==="month"?(m.setDate(1),m.setHours(0),m.setMinutes(0),m.setSeconds(0),d=new Date(m),d.setMonth(m.getMonth()+1),d.setSeconds(-1),_.setMonth(_.getMonth()+1),g.setMonth(g.getMonth()-1)):(m.setDate(m.getDate()-m.getDay()+1),m.setHours(0),m.setMinutes(0),m.setSeconds(0),d=new Date(m),d.setDate(m.getDate()+7),d.setSeconds(-1),_.setDate(_.getDate()+7),g.setDate(g.getDate()-7)),{upper:d,lower:m,upperUS:this.formatDate(d),lowerUS:this.formatDate(m),next:`${_.getFullYear()}-${("0"+(_.getMonth()+1)).slice(-2)}-${("0"+_.getDate()).slice(-2)}`,prev:`${g.getFullYear()}-${("0"+(g.getMonth()+1)).slice(-2)}-${("0"+g.getDate()).slice(-2)}`}}escapeStringForFilename(t,n="-"){return[34,60,62,124,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,58,42,63,92,47].forEach(a=>{const s=String.fromCharCode(a);for(;t.indexOf(s)>-1;)t=t.replace(s,n)}),t}}const ct=it("settings",{state:()=>{const r=new Y,{defaultDateFormat:t,defaultDateRangeFormat:n}=new dt().defaultDates();return r.get("settings",N(U({},Pu),{dateFormat:t,dateRangeFormat:n}))},actions:{update(r,t){this[r]=t}}});const Vu={inject:["util","globalStore","settings"],components:{TimerList:ju,HelpDialog:ou,ImportExportDialog:td,ImportSyncCredentialsFromURLDialog:bd,SyncOptionsDialog:ns,SettingsDialog:Wn,ToastBox:Lo,LogTable:Na,InputBox:ui,LoadingModal:Wa,TopBar:ul,OffCanvasMenu:Oo,InspectDialog:ko},data(){const r=new Y,t=new B(N(U({},ct()),{util:this.util})),n=new q(t,{deviceId:this.settings.deviceId,util:this.util,storeFunction:this.store.bind(this),storage:r}),a=new K(n);return{syncIsRunning:!1,suggestionProvider:a,timelogStore:n,storage:r,parser:t,sync:new H(r),timers:new tt(r,t)}},mounted(){this.timelogStore.checkIntegrity(),this.settings.syncEnabled&&this.sync.hasCredentials&&this.syncIfNeeded(),new URL(window.location).searchParams.has("encryptedSyncCredentials")&&this.$refs.importFromURL.show(),/h=([\w]+)/.test(window.location.hash)&&(this.$refs.help.show(/h=([\w]+)/.exec(window.location.hash)[1]),window.location.hash="")},watch:{settings:{deep:!0,handler:function(){Object.keys(this.parser.options).forEach(r=>{r in this.settings&&(this.parser.options[r]=this.settings[r])})}}},methods:{enableSync(){!this.syncIsRunning&&this.sync.hasCredentials&&(this.globalStore.toast("sync enabled"),this.syncIfNeeded(!0))},syncIfNeeded(r=!1,t=!1){this.sync.needsUpdate().then(n=>{n||t?this.sync.load().then(a=>{if("settings"in a&&a.settings.syncSettings===!0){let s=0;for(const o in a.settings)o!=="deviceName"&&o!=="deviceId"&&this.settings[o]!==a.settings[o]&&(this.settings[o]=a.settings[o],s++);s>0&&this.globalStore.toast("settings synced")}if("transactions"in a){const s=this.timelogStore.mergeTransactions(a.transactions);s>0&&this.globalStore.toast(`synced ${s} transactions...`),this.suggestionProvider.rebuild()}this.$refs.logTable.updateTableData(),this.timelogStore.currentTransaction&&this.store()}):this.timelogStore.currentTransaction&&this.store(),r&&this.globalStore.toast("synced...")}).catch(n=>{this.globalStore.toast("sync",n)}),this.setSyncTimeout()},setSyncTimeout(){const r=this.settings.checkForUpdateIntervalMinutes;if(clearTimeout(this.syncTimeout),this.syncTimeout=null,Math.abs(r)===0||!this.settings.syncEnabled){console.log("disabling sync"),this.syncIsRunning=!1;return}this.syncIsRunning=!0,this.syncTimeout=setTimeout(this.syncIfNeeded.bind(this),r*60*1e3)},store(){this.globalStore.setLoading(!0),this.timelogStore.commit(!0),this.sync.store({transactions:this.timelogStore.transactions,settings:this.settings.$state}).then(r=>{this.globalStore.setLoading(!1),this.globalStore.toast(`${this.util.formatBytes(r.encrypted)} (${this.util.formatBytes(r.original)}) uploaded`)})},syncNow(){this.syncIfNeeded(!0,!0),setTimeout(this.store.bind(this),2500)},logFromTimer(r){this.timelogStore.insert(r),this.$refs.logTable.updateTableData(),this.globalStore.toast("created log from timer...")}}},Ou={class:"container"};function Bu(r,t,n,a,s,o){const i=w("LoadingModal"),d=w("TopBar"),m=w("InputBox"),_=w("TimerList"),g=w("LogTable"),C=w("SettingsDialog"),I=w("HelpDialog"),y=w("SyncOptionsDialog"),R=w("InspectDialog"),M=w("ImportExportDialog"),A=w("ImportSyncCredentialsFromURLDialog"),z=w("ToastBox"),ht=w("OffCanvasMenu");return l(),c(T,null,[x(i),x(d),e("div",Ou,[x(m,{ref:"input",parser:s.parser,"log-store":s.timelogStore,"suggestion-provider":s.suggestionProvider,timers:s.timers,onShowHelp:t[0]||(t[0]=E=>r.$refs.help.show("help")),onReloadTable:t[1]||(t[1]=E=>r.$refs.logTable.updateTableData())},null,8,["parser","log-store","suggestion-provider","timers"]),s.timers.timers.length>0?(l(),V(_,{key:0,timers:s.timers,"log-parser":s.parser,onEndTimer:o.logFromTimer},null,8,["timers","log-parser","onEndTimer"])):f("",!0),x(g,{ref:"logTable","log-store":s.timelogStore,"log-parser":s.parser,"suggestion-provider":s.suggestionProvider,onHideSuggestions:t[2]||(t[2]=E=>r.$refs.input.unsetSuggestions()),onEditLog:t[3]||(t[3]=E=>r.$refs.input.editLog(E))},null,8,["log-store","log-parser","suggestion-provider"])]),x(C,{ref:"settings",storage:s.storage,sync:s.sync,onEnableSync:o.enableSync},null,8,["storage","sync","onEnableSync"]),x(I,{ref:"help",parser:s.parser},null,8,["parser"]),x(y,{ref:"syncOptions",sync:s.sync},null,8,["sync"]),x(R,{ref:"inspect","timelog-store":s.timelogStore},null,8,["timelog-store"]),x(M,{ref:"importExport","timelog-store":s.timelogStore,sync:s.sync,"suggestion-provider":s.suggestionProvider},null,8,["timelog-store","sync","suggestion-provider"]),x(A,{ref:"importFromURL",sync:s.sync},null,8,["sync"]),x(z),x(ht,{sync:s.sync,onShowSettings:t[4]||(t[4]=E=>r.$refs.settings.show()),onShowSyncOptions:t[5]||(t[5]=E=>r.$refs.syncOptions.show()),onInspectData:t[6]||(t[6]=E=>r.$refs.inspect.show()),onShowImportDialog:t[7]||(t[7]=E=>r.$refs.importExport.show()),onSyncNow:t[8]||(t[8]=E=>o.syncNow()),onShowHelpDialog:t[9]||(t[9]=E=>r.$refs.help.show())},null,8,["sync"])],64)}var Au=v(Vu,[["render",Bu],["__scopeId","data-v-1d68b87a"]]);const Hu=it("globalStore",{state:()=>({toasts:[],loading:!1}),actions:{toast(r,t,n=2e3){this.toasts.push({title:r,body:t}),setTimeout(()=>{this.toasts.shift()},n)},toggleLoading(){this.loading=!this.loading},setLoading(r=!0){this.loading=r}}}),Q=Ct(Au);Q.use(St());const ut=new dt,zu=Hu(),P=ct();Q.provide("util",ut);Q.provide("globalStore",zu);Q.provide("settings",P);P.$subscribe(()=>{const r=new Y,t=U({},P.$state);r.set("settings",t)},{detached:!0});P.showHelpIcon||P.$patch({showHelpIcon:!0});if(!P.deviceId){P.deviceId=ut.hash(16);const r=new Dt.exports.UAParser().getResult();P.deviceName=`${r.browser.name} on ${r.os.name} ${r.os.version} (${r.cpu.architecture})`}Q.mount("#app");
